var protomaps=(()=>{var Kt=Object.create;var de=Object.defineProperty;var ei=Object.getOwnPropertyDescriptor;var ti=Object.getOwnPropertyNames,rt=Object.getOwnPropertySymbols,ii=Object.getPrototypeOf,nt=Object.prototype.hasOwnProperty,ri=Object.prototype.propertyIsEnumerable;var qe=(e,t,i)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,at=(e,t)=>{for(var i in t||(t={}))nt.call(t,i)&&qe(e,i,t[i]);if(rt)for(var i of rt(t))ri.call(t,i)&&qe(e,i,t[i]);return e};var st=e=>de(e,"__esModule",{value:!0});var R=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ni=(e,t)=>{st(e);for(var i in t)de(e,i,{get:t[i],enumerable:!0})},ai=(e,t,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ti(t))!nt.call(e,r)&&r!=="default"&&de(e,r,{get:()=>t[r],enumerable:!(i=ei(t,r))||i.enumerable});return e},V=e=>ai(st(de(e!=null?Kt(ii(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var J=(e,t,i)=>(qe(e,typeof t!="symbol"?t+"":t,i),i);var D=(e,t,i)=>new Promise((r,a)=>{var n=o=>{try{l(i.next(o))}catch(h){a(h)}},s=o=>{try{l(i.throw(o))}catch(h){a(h)}},l=o=>o.done?r(o.value):Promise.resolve(o.value).then(n,s);l((i=i.apply(e,t)).next())});var A=R((fr,lt)=>{"use strict";lt.exports=K;function K(e,t){this.x=e,this.y=t}K.prototype={clone:function(){return new K(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,i=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=t*this.x-i*this.y,a=i*this.x+t*this.y;return this.x=r,this.y=a,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),a=t.x+i*(this.x-t.x)-r*(this.y-t.y),n=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=a,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};K.convert=function(e){return e instanceof K?e:Array.isArray(e)?new K(e[0],e[1]):e}});var Ae=R((dr,ot)=>{"use strict";var si=A();ot.exports=ee;function ee(e,t,i,r,a){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=a,e.readFields(li,this,t)}function li(e,t,i){e==1?t.id=i.readVarint():e==2?oi(i,t):e==3?t.type=i.readVarint():e==4&&(t._geometry=i.pos)}function oi(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],a=t._values[e.readVarint()];t.properties[r]=a}}ee.types=["Unknown","Point","LineString","Polygon"];ee.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,a=0,n=0,s=[],l;e.pos<t;){if(r<=0){var o=e.readVarint();i=o&7,r=o>>3}if(r--,i===1||i===2)a+=e.readSVarint(),n+=e.readSVarint(),i===1&&(l&&s.push(l),l=[]),l.push(new si(a,n));else if(i===7)l&&l.push(l[0].clone());else throw new Error("unknown command "+i)}return l&&s.push(l),s};ee.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,a=0,n=0,s=1/0,l=-1/0,o=1/0,h=-1/0;e.pos<t;){if(r<=0){var d=e.readVarint();i=d&7,r=d>>3}if(r--,i===1||i===2)a+=e.readSVarint(),n+=e.readSVarint(),a<s&&(s=a),a>l&&(l=a),n<o&&(o=n),n>h&&(h=n);else if(i!==7)throw new Error("unknown command "+i)}return[s,o,l,h]};ee.prototype.toGeoJSON=function(e,t,i){var r=this.extent*Math.pow(2,i),a=this.extent*e,n=this.extent*t,s=this.loadGeometry(),l=ee.types[this.type],o,h;function d(y){for(var b=0;b<y.length;b++){var g=y[b],u=180-(g.y+n)*360/r;y[b]=[(g.x+a)*360/r-180,360/Math.PI*Math.atan(Math.exp(u*Math.PI/180))-90]}}switch(this.type){case 1:var x=[];for(o=0;o<s.length;o++)x[o]=s[o][0];s=x,d(s);break;case 2:for(o=0;o<s.length;o++)d(s[o]);break;case 3:for(s=hi(s),o=0;o<s.length;o++)for(h=0;h<s[o].length;h++)d(s[o][h]);break}s.length===1?s=s[0]:l="Multi"+l;var c={type:"Feature",geometry:{type:l,coordinates:s},properties:this.properties};return"id"in this&&(c.id=this.id),c};function hi(e){var t=e.length;if(t<=1)return[e];for(var i=[],r,a,n=0;n<t;n++){var s=ui(e[n]);s!==0&&(a===void 0&&(a=s<0),a===s<0?(r&&i.push(r),r=[e[n]]):r.push(e[n]))}return r&&i.push(r),i}function ui(e){for(var t=0,i=0,r=e.length,a=r-1,n,s;i<r;a=i++)n=e[i],s=e[a],t+=(s.x-n.x)*(n.y+s.y);return t}});var $e=R((cr,ut)=>{"use strict";var fi=Ae();ut.exports=ht;function ht(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(di,this,t),this.length=this._features.length}function di(e,t,i){e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(ci(i))}function ci(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null}return t}ht.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new fi(this._pbf,t,this.extent,this._keys,this._values)}});var dt=R((mr,ft)=>{"use strict";var mi=$e();ft.exports=xi;function xi(e,t){this.layers=e.readFields(pi,{},t)}function pi(e,t,i){if(e===3){var r=new mi(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}});var ct=R((xr,ke)=>{ke.exports.VectorTile=dt();ke.exports.VectorTileFeature=Ae();ke.exports.VectorTileLayer=$e()});var mt=R(je=>{je.read=function(e,t,i,r,a){var n,s,l=a*8-r-1,o=(1<<l)-1,h=o>>1,d=-7,x=i?a-1:0,c=i?-1:1,y=e[t+x];for(x+=c,n=y&(1<<-d)-1,y>>=-d,d+=l;d>0;n=n*256+e[t+x],x+=c,d-=8);for(s=n&(1<<-d)-1,n>>=-d,d+=r;d>0;s=s*256+e[t+x],x+=c,d-=8);if(n===0)n=1-h;else{if(n===o)return s?NaN:(y?-1:1)*(1/0);s=s+Math.pow(2,r),n=n-h}return(y?-1:1)*s*Math.pow(2,n-r)};je.write=function(e,t,i,r,a,n){var s,l,o,h=n*8-a-1,d=(1<<h)-1,x=d>>1,c=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=r?0:n-1,b=r?1:-1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(o=Math.pow(2,-s))<1&&(s--,o*=2),s+x>=1?t+=c/o:t+=c*Math.pow(2,1-x),t*o>=2&&(s++,o/=2),s+x>=d?(l=0,s=d):s+x>=1?(l=(t*o-1)*Math.pow(2,a),s=s+x):(l=t*Math.pow(2,x-1)*Math.pow(2,a),s=0));a>=8;e[i+y]=l&255,y+=b,l/=256,a-=8);for(s=s<<a|l,h+=a;h>0;e[i+y]=s&255,y+=b,s/=256,h-=8);e[i+y-b]|=g*128}});var wt=R((yr,gt)=>{"use strict";gt.exports=M;var Me=mt();function M(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}M.Varint=0;M.Fixed64=1;M.Bytes=2;M.Fixed32=5;var Ue=(1<<16)*(1<<16),xt=1/Ue,yi=12,pt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");M.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),a=r>>3,n=this.pos;this.type=r&7,e(a,t,this),this.pos===n&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Le(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=bt(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Le(this.buf,this.pos)+Le(this.buf,this.pos+4)*Ue;return this.pos+=8,e},readSFixed64:function(){var e=Le(this.buf,this.pos)+bt(this.buf,this.pos+4)*Ue;return this.pos+=8,e},readFloat:function(){var e=Me.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Me.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,i,r;return r=t[this.pos++],i=r&127,r<128||(r=t[this.pos++],i|=(r&127)<<7,r<128)||(r=t[this.pos++],i|=(r&127)<<14,r<128)||(r=t[this.pos++],i|=(r&127)<<21,r<128)?i:(r=t[this.pos],i|=(r&15)<<28,bi(i,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=yi&&pt?Ci(this.buf,t,e):Pi(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==M.Bytes)return e.push(this.readVarint(t));var i=E(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==M.Bytes)return e.push(this.readSVarint());var t=E(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==M.Bytes)return e.push(this.readBoolean());var t=E(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==M.Bytes)return e.push(this.readFloat());var t=E(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==M.Bytes)return e.push(this.readDouble());var t=E(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==M.Bytes)return e.push(this.readFixed32());var t=E(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==M.Bytes)return e.push(this.readSFixed32());var t=E(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==M.Bytes)return e.push(this.readFixed64());var t=E(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==M.Bytes)return e.push(this.readSFixed64());var t=E(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===M.Varint)for(;this.buf[this.pos++]>127;);else if(t===M.Bytes)this.pos=this.readVarint()+this.pos;else if(t===M.Fixed32)this.pos+=4;else if(t===M.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),ie(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),ie(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),ie(this.buf,e&-1,this.pos),ie(this.buf,Math.floor(e*xt),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),ie(this.buf,e&-1,this.pos),ie(this.buf,Math.floor(e*xt),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){gi(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=Di(this.buf,e,this.pos);var i=this.pos-t;i>=128&&yt(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Me.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Me.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&yt(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,M.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,_i,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Fi,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Mi,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,zi,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ki,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Li,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Si,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Ti,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Bi,t)},writeBytesField:function(e,t){this.writeTag(e,M.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,M.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,M.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,M.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,M.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,M.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,M.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,M.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,M.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,M.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};function bi(e,t,i){var r=i.buf,a,n;if(n=r[i.pos++],a=(n&112)>>4,n<128||(n=r[i.pos++],a|=(n&127)<<3,n<128)||(n=r[i.pos++],a|=(n&127)<<10,n<128)||(n=r[i.pos++],a|=(n&127)<<17,n<128)||(n=r[i.pos++],a|=(n&127)<<24,n<128)||(n=r[i.pos++],a|=(n&1)<<31,n<128))return te(e,a,t);throw new Error("Expected varint not more than 10 bytes")}function E(e){return e.type===M.Bytes?e.readVarint()+e.pos:e.pos+1}function te(e,t,i){return i?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function gi(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(i=~(-e%4294967296),r=~(-e/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),wi(i,r,t),vi(r,t)}function wi(e,t,i){i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos]=e&127}function vi(e,t){var i=(e&7)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),!!e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),!!e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),!!e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),!!e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),!!e&&(t.buf[t.pos++]=e&127)))))}function yt(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));i.realloc(r);for(var a=i.pos-1;a>=e;a--)i.buf[a+r]=i.buf[a]}function _i(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function Fi(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function zi(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function ki(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Mi(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function Li(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Si(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Ti(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Bi(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Le(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function ie(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function bt(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Pi(e,t,i){for(var r="",a=t;a<i;){var n=e[a],s=null,l=n>239?4:n>223?3:n>191?2:1;if(a+l>i)break;var o,h,d;l===1?n<128&&(s=n):l===2?(o=e[a+1],(o&192)==128&&(s=(n&31)<<6|o&63,s<=127&&(s=null))):l===3?(o=e[a+1],h=e[a+2],(o&192)==128&&(h&192)==128&&(s=(n&15)<<12|(o&63)<<6|h&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):l===4&&(o=e[a+1],h=e[a+2],d=e[a+3],(o&192)==128&&(h&192)==128&&(d&192)==128&&(s=(n&15)<<18|(o&63)<<12|(h&63)<<6|d&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,l=1):s>65535&&(s-=65536,r+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),r+=String.fromCharCode(s),a+=l}return r}function Ci(e,t,i){return pt.decode(e.subarray(t,i))}function Di(e,t,i){for(var r=0,a,n;r<t.length;r++){if(a=t.charCodeAt(r),a>55295&&a<57344)if(n)if(a<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=a;continue}else a=n-55296<<10|a-56320|65536,n=null;else{a>56319||r+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=a;continue}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);a<128?e[i++]=a:(a<2048?e[i++]=a>>6|192:(a<65536?e[i++]=a>>12|224:(e[i++]=a>>18|240,e[i++]=a>>12&63|128),e[i++]=a>>6&63|128),e[i++]=a&63|128)}return i}});var Tt=R((We,Oe)=>{(function(e,t){typeof We=="object"&&typeof Oe!="undefined"?Oe.exports=t():typeof define=="function"&&define.amd?define(t):(e=e||self).RBush=t()})(We,function(){"use strict";function e(u,f,m,w,p){(function v(_,F,z,k,T){for(;k>z;){if(k-z>600){var S=k-z+1,P=F-z+1,ue=Math.log(S),j=.5*Math.exp(2*ue/3),G=.5*Math.sqrt(ue*j*(S-j)/S)*(P-S/2<0?-1:1),Q=Math.max(z,Math.floor(F-P*j/S+G)),Jt=Math.min(k,Math.floor(F+(S-P)*j/S+G));v(_,F,Q,Jt,T)}var ze=_[F],fe=z,Y=k;for(t(_,z,F),T(_[k],ze)>0&&t(_,z,k);fe<Y;){for(t(_,fe,Y),fe++,Y--;T(_[fe],ze)<0;)fe++;for(;T(_[Y],ze)>0;)Y--}T(_[z],ze)===0?t(_,z,Y):t(_,++Y,k),Y<=F&&(z=Y+1),F<=Y&&(k=Y-1)}})(u,f,m||0,w||u.length-1,p||i)}function t(u,f,m){var w=u[f];u[f]=u[m],u[m]=w}function i(u,f){return u<f?-1:u>f?1:0}var r=function(u){u===void 0&&(u=9),this._maxEntries=Math.max(4,u),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(u,f,m){if(!m)return f.indexOf(u);for(var w=0;w<f.length;w++)if(m(u,f[w]))return w;return-1}function n(u,f){s(u,0,u.children.length,f,u)}function s(u,f,m,w,p){p||(p=b(null)),p.minX=1/0,p.minY=1/0,p.maxX=-1/0,p.maxY=-1/0;for(var v=f;v<m;v++){var _=u.children[v];l(p,u.leaf?w(_):_)}return p}function l(u,f){return u.minX=Math.min(u.minX,f.minX),u.minY=Math.min(u.minY,f.minY),u.maxX=Math.max(u.maxX,f.maxX),u.maxY=Math.max(u.maxY,f.maxY),u}function o(u,f){return u.minX-f.minX}function h(u,f){return u.minY-f.minY}function d(u){return(u.maxX-u.minX)*(u.maxY-u.minY)}function x(u){return u.maxX-u.minX+(u.maxY-u.minY)}function c(u,f){return u.minX<=f.minX&&u.minY<=f.minY&&f.maxX<=u.maxX&&f.maxY<=u.maxY}function y(u,f){return f.minX<=u.maxX&&f.minY<=u.maxY&&f.maxX>=u.minX&&f.maxY>=u.minY}function b(u){return{children:u,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(u,f,m,w,p){for(var v=[f,m];v.length;)if(!((m=v.pop())-(f=v.pop())<=w)){var _=f+Math.ceil((m-f)/w/2)*w;e(u,_,f,m,p),v.push(f,_,_,m)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(u){var f=this.data,m=[];if(!y(u,f))return m;for(var w=this.toBBox,p=[];f;){for(var v=0;v<f.children.length;v++){var _=f.children[v],F=f.leaf?w(_):_;y(u,F)&&(f.leaf?m.push(_):c(u,F)?this._all(_,m):p.push(_))}f=p.pop()}return m},r.prototype.collides=function(u){var f=this.data;if(!y(u,f))return!1;for(var m=[];f;){for(var w=0;w<f.children.length;w++){var p=f.children[w],v=f.leaf?this.toBBox(p):p;if(y(u,v)){if(f.leaf||c(u,v))return!0;m.push(p)}}f=m.pop()}return!1},r.prototype.load=function(u){if(!u||!u.length)return this;if(u.length<this._minEntries){for(var f=0;f<u.length;f++)this.insert(u[f]);return this}var m=this._build(u.slice(),0,u.length-1,0);if(this.data.children.length)if(this.data.height===m.height)this._splitRoot(this.data,m);else{if(this.data.height<m.height){var w=this.data;this.data=m,m=w}this._insert(m,this.data.height-m.height-1,!0)}else this.data=m;return this},r.prototype.insert=function(u){return u&&this._insert(u,this.data.height-1),this},r.prototype.clear=function(){return this.data=b([]),this},r.prototype.remove=function(u,f){if(!u)return this;for(var m,w,p,v=this.data,_=this.toBBox(u),F=[],z=[];v||F.length;){if(v||(v=F.pop(),w=F[F.length-1],m=z.pop(),p=!0),v.leaf){var k=a(u,v.children,f);if(k!==-1)return v.children.splice(k,1),F.push(v),this._condense(F),this}p||v.leaf||!c(v,_)?w?(m++,v=w.children[m],p=!1):v=null:(F.push(v),z.push(m),m=0,w=v,v=v.children[0])}return this},r.prototype.toBBox=function(u){return u},r.prototype.compareMinX=function(u,f){return u.minX-f.minX},r.prototype.compareMinY=function(u,f){return u.minY-f.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(u){return this.data=u,this},r.prototype._all=function(u,f){for(var m=[];u;)u.leaf?f.push.apply(f,u.children):m.push.apply(m,u.children),u=m.pop();return f},r.prototype._build=function(u,f,m,w){var p,v=m-f+1,_=this._maxEntries;if(v<=_)return n(p=b(u.slice(f,m+1)),this.toBBox),p;w||(w=Math.ceil(Math.log(v)/Math.log(_)),_=Math.ceil(v/Math.pow(_,w-1))),(p=b([])).leaf=!1,p.height=w;var F=Math.ceil(v/_),z=F*Math.ceil(Math.sqrt(_));g(u,f,m,z,this.compareMinX);for(var k=f;k<=m;k+=z){var T=Math.min(k+z-1,m);g(u,k,T,F,this.compareMinY);for(var S=k;S<=T;S+=F){var P=Math.min(S+F-1,T);p.children.push(this._build(u,S,P,w-1))}}return n(p,this.toBBox),p},r.prototype._chooseSubtree=function(u,f,m,w){for(;w.push(f),!f.leaf&&w.length-1!==m;){for(var p=1/0,v=1/0,_=void 0,F=0;F<f.children.length;F++){var z=f.children[F],k=d(z),T=(S=u,P=z,(Math.max(P.maxX,S.maxX)-Math.min(P.minX,S.minX))*(Math.max(P.maxY,S.maxY)-Math.min(P.minY,S.minY))-k);T<v?(v=T,p=k<p?k:p,_=z):T===v&&k<p&&(p=k,_=z)}f=_||f.children[0]}var S,P;return f},r.prototype._insert=function(u,f,m){var w=m?u:this.toBBox(u),p=[],v=this._chooseSubtree(w,this.data,f,p);for(v.children.push(u),l(v,w);f>=0&&p[f].children.length>this._maxEntries;)this._split(p,f),f--;this._adjustParentBBoxes(w,p,f)},r.prototype._split=function(u,f){var m=u[f],w=m.children.length,p=this._minEntries;this._chooseSplitAxis(m,p,w);var v=this._chooseSplitIndex(m,p,w),_=b(m.children.splice(v,m.children.length-v));_.height=m.height,_.leaf=m.leaf,n(m,this.toBBox),n(_,this.toBBox),f?u[f-1].children.push(_):this._splitRoot(m,_)},r.prototype._splitRoot=function(u,f){this.data=b([u,f]),this.data.height=u.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(u,f,m){for(var w,p,v,_,F,z,k,T=1/0,S=1/0,P=f;P<=m-f;P++){var ue=s(u,0,P,this.toBBox),j=s(u,P,m,this.toBBox),G=(p=ue,v=j,_=void 0,F=void 0,z=void 0,k=void 0,_=Math.max(p.minX,v.minX),F=Math.max(p.minY,v.minY),z=Math.min(p.maxX,v.maxX),k=Math.min(p.maxY,v.maxY),Math.max(0,z-_)*Math.max(0,k-F)),Q=d(ue)+d(j);G<T?(T=G,w=P,S=Q<S?Q:S):G===T&&Q<S&&(S=Q,w=P)}return w||m-f},r.prototype._chooseSplitAxis=function(u,f,m){var w=u.leaf?this.compareMinX:o,p=u.leaf?this.compareMinY:h;this._allDistMargin(u,f,m,w)<this._allDistMargin(u,f,m,p)&&u.children.sort(w)},r.prototype._allDistMargin=function(u,f,m,w){u.children.sort(w);for(var p=this.toBBox,v=s(u,0,f,p),_=s(u,m-f,m,p),F=x(v)+x(_),z=f;z<m-f;z++){var k=u.children[z];l(v,u.leaf?p(k):k),F+=x(v)}for(var T=m-f-1;T>=f;T--){var S=u.children[T];l(_,u.leaf?p(S):S),F+=x(_)}return F},r.prototype._adjustParentBBoxes=function(u,f,m){for(var w=m;w>=0;w--)l(f[w],u)},r.prototype._condense=function(u){for(var f=u.length-1,m=void 0;f>=0;f--)u[f].children.length===0?f>0?(m=u[f-1].children).splice(m.indexOf(u[f]),1):this.clear():n(u[f],this.toBBox)},r})});var Ct=R((Ne,He)=>{(function(e,t){typeof Ne=="object"&&typeof He!="undefined"?He.exports=t():typeof define=="function"&&define.amd?define(t):(e=e||self,e.TinyQueue=t())})(Ne,function(){"use strict";var e=function(r,a){if(r===void 0&&(r=[]),a===void 0&&(a=t),this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};e.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(this.length!==0){var r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(r){for(var a=this,n=a.data,s=a.compare,l=n[r];r>0;){var o=r-1>>1,h=n[o];if(s(l,h)>=0)break;n[r]=h,r=o}n[r]=l},e.prototype._down=function(r){for(var a=this,n=a.data,s=a.compare,l=this.length>>1,o=n[r];r<l;){var h=(r<<1)+1,d=n[h],x=h+1;if(x<this.length&&s(n[x],d)<0&&(h=x,d=n[x]),s(d,o)>=0)break;n[r]=d,r=h}n[r]=o};function t(i,r){return i<r?-1:i>r?1:0}return e})});var Xt=R((Dr,Ge)=>{"use strict";var Xe=Ct();Xe.default&&(Xe=Xe.default);Ge.exports=Dt;Ge.exports.default=Dt;function Dt(e,t,i){t=t||1;for(var r,a,n,s,l=0;l<e[0].length;l++){var o=e[0][l];(!l||o[0]<r)&&(r=o[0]),(!l||o[1]<a)&&(a=o[1]),(!l||o[0]>n)&&(n=o[0]),(!l||o[1]>s)&&(s=o[1])}var h=n-r,d=s-a,x=Math.min(h,d),c=x/2;if(x===0){var y=[r,a];return y.distance=0,y}for(var b=new Xe(void 0,Ei),g=r;g<n;g+=x)for(var u=a;u<s;u+=x)b.push(new $(g+c,u+c,c,e));var f=Ai(e),m=new $(r+h/2,a+d/2,0,e);m.d>f.d&&(f=m);for(var w=b.length;b.length;){var p=b.pop();p.d>f.d&&(f=p,i&&console.log("found best %d after %d probes",Math.round(1e4*p.d)/1e4,w)),!(p.max-f.d<=t)&&(c=p.h/2,b.push(new $(p.x-c,p.y-c,c,e)),b.push(new $(p.x+c,p.y-c,c,e)),b.push(new $(p.x-c,p.y+c,c,e)),b.push(new $(p.x+c,p.y+c,c,e)),w+=4)}i&&(console.log("num probes: "+w),console.log("best distance: "+f.d));var v=[f.x,f.y];return v.distance=f.d,v}function Ei(e,t){return t.max-e.max}function $(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=qi(e,t,r),this.max=this.d+this.h*Math.SQRT2}function qi(e,t,i){for(var r=!1,a=1/0,n=0;n<i.length;n++)for(var s=i[n],l=0,o=s.length,h=o-1;l<o;h=l++){var d=s[l],x=s[h];d[1]>t!=x[1]>t&&e<(x[0]-d[0])*(t-d[1])/(x[1]-d[1])+d[0]&&(r=!r),a=Math.min(a,$i(e,t,d,x))}return a===0?0:(r?1:-1)*Math.sqrt(a)}function Ai(e){for(var t=0,i=0,r=0,a=e[0],n=0,s=a.length,l=s-1;n<s;l=n++){var o=a[n],h=a[l],d=o[0]*h[1]-h[0]*o[1];i+=(o[0]+h[0])*d,r+=(o[1]+h[1])*d,t+=d*3}return t===0?new $(a[0][0],a[0][1],0,e):new $(i/t,r/t,0,e)}function $i(e,t,i,r){var a=i[0],n=i[1],s=r[0]-a,l=r[1]-n;if(s!==0||l!==0){var o=((e-a)*s+(t-n)*l)/(s*s+l*l);o>1?(a=r[0],n=r[1]):o>0&&(a+=s*o,n+=l*o)}return s=e-a,l=t-n,s*s+l*l}});var Rt=R((Rr,Yt)=>{Yt.exports=function(e,t){var i=[],r=[null],a,n,s,l=0,o=0,h=0,d=0,x=0,c=0,y=0,b=0,g=0,u=0,f=0,m=0;if(e.length<2)return[];if(e.length===2)return h=Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2)),[{length:h,beginIndex:0,beginDistance:0,endIndex:2,endDistance:h,angles:[null,null]}];for(d=Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2)),l=1,o=e.length-1;l<o;l++)a=e[l-1],n=e[l],s=e[l+1],c=n.x-a.x,y=n.y-a.y,b=s.x-n.x,g=s.y-n.y,x=Math.sqrt(b*b+g*g),h+=d,u=Math.acos((c*b+y*g)/(d*x)),r.push(u),u>t&&(i.push({length:h-m,beginDistance:m,beginIndex:f,endIndex:l+1,endDistance:h,angles:r}),f=l,m=h,r=[u]),d=x;return r.push(null),l-f>0&&i.push({length:h-m+x,beginIndex:f,beginDistance:m,endIndex:l+1,endDistance:h+x,angles:r}),i}});var hr={};ni(hr,{CenteredTextSymbolizer:()=>I,CircleSymbolizer:()=>be,FlexSymbolizer:()=>ge,Font:()=>sr,GroupSymbolizer:()=>we,IconSymbolizer:()=>At,LineLabelSymbolizer:()=>ae,LineSymbolizer:()=>C,OffsetTextSymbolizer:()=>H,PMTiles:()=>ce,PolygonLabelSymbolizer:()=>se,PolygonSymbolizer:()=>B,ShieldSymbolizer:()=>Ye,Sprites:()=>lr,Static:()=>Nt,arr:()=>Zi,createPattern:()=>Ui,dark:()=>ne,exp:()=>X,filterFn:()=>Fe,getFont:()=>it,json_style:()=>or,labelRules:()=>he,leafletLayer:()=>rr,light:()=>re,numberFn:()=>Ee,numberOrFn:()=>et,paintRules:()=>oe,widthFn:()=>tt});var Re=V(A());var Se=V(A()),zt=V(ct()),kt=V(wt());var vt=(e,t)=>e*Math.pow(2,t),_t=(e,t)=>vt(e.getUint16(t+1,!0),8)+e.getUint8(t,!0),Xi=(e,t)=>vt(e.getUint32(t+2,!0),16)+e.getUint16(t,!0),Yi=e=>{var t=e.getUint16(0,!0),i=e.getUint16(2,!0),r=e.getUint32(4,!0),a=e.getUint16(8,!0);return{version:i,json_size:r,root_entries:a}},Ft=e=>{let t=new Map;for(var i=0;i<e.byteLength;i+=17){var r=e.getUint8(i,!0),a=r&127,n=r>>7,s=_t(e,i+1),l=_t(e,i+4),o=Xi(e,i+7),h=e.getUint32(i+13,!0);t.set(a+"_"+s+"_"+l,[o,h,n])}return t},ce=class{constructor(t){J(this,"metadata",t=>new Promise((i,r)=>{this.root.then(a=>{i(a.metadata)})}));J(this,"getLeaf",(t,i)=>new Promise((r,a)=>{this.leaves.has(t)?(this.leaves.get(t)[0]++,r(this.leaves.get(t)[1])):this.outstanding_requests.has(t)?this.outstanding_requests.get(t).push(r):(this.outstanding_requests.set(t,[]),fetch(this.url,{headers:{Range:"bytes="+t+"-"+(t+i-1)}}).then(n=>n.arrayBuffer()).then(n=>{var s=Ft(new DataView(n),i/17);if(this.leaves.size>32){var l=1/0,o=void 0;this.leaves.forEach((h,d)=>{h[0]<l&&(l=h[0],o=d)}),this.leaves.delete(o)}this.leaves.set(t,[this.step++,s]),r(s),this.outstanding_requests.get(t).forEach(h=>h(s)),this.outstanding_requests.delete(t)}))}));J(this,"getZxy",(t,i,r)=>{var a=t+"_"+i+"_"+r;return this.root.then(n=>{if(n.dir.has(a)&&n.dir.get(a)[2]==0)return n.dir.get(a);if(t>=7){var s=t-7,l=[7,Math.trunc(i/(1<<s)),Math.trunc(r/(1<<s))],o=l[0]+"_"+l[1]+"_"+l[2];if(n.dir.has(o)&&n.dir.get(o)[2]==1){let h=n.dir.get(o);return this.getLeaf(h[0],h[1]).then(d=>d.has(a)?d.get(a):null)}}return null})});J(this,"transformRequest",(t,i,r,a)=>{if(t.endsWith(".pmtiles")&&a){var n=r.tileID.canonical,s=n.z+"_"+n.x+"_"+n.y;this.getZxy(n.z,n.x,n.y).then(l=>{l&&a({url:this.url,headers:{Range:"bytes="+l[0]+"-"+(l[0]+l[1]-1)}})})}return{url:t}});J(this,"leafletLayer",t=>{let i=this;var r=L.GridLayer.extend({createTile:function(a,n){var s=document.createElement("img"),l;return i.getZxy(a.z,a.x,a.y).then(o=>{o!==null&&fetch(i.url,{headers:{Range:"bytes="+o[0]+"-"+(o[0]+o[1]-1)}}).then(h=>h.arrayBuffer()).then(h=>{var d=new Blob([h],{type:"image/png"}),x=window.URL.createObjectURL(d);s.src=x,n(l,s)})}),s},_removeTile:function(a){var n=this._tiles[a];!n||(n.el.width=0,n.el.height=0,n.el.deleted=!0,L.DomUtil.remove(n.el),delete this._tiles[a],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(a)}))}});return new r(t)});this.url=t;let i=new AbortController,r=i.signal;this.root=fetch(this.url,{signal:r,headers:{Range:"bytes=0-511999"}}).then(a=>(a.headers.get("Content-Length")!=512e3&&(console.error("Content-Length mismatch indicates byte serving not supported; aborting."),i.abort()),a.arrayBuffer())).then(a=>{let n=Yi(new DataView(a,0,10));var s=new TextDecoder("utf-8");return{metadata:JSON.parse(s.decode(new DataView(a,10,n.json_size))),dir:Ft(new DataView(a,10+n.json_size,17*n.root_entries))}}),this.step=0,this.leaves=new Map,this.outstanding_requests=new Map}};var me;(function(r){r[r.Point=1]="Point",r[r.Line=2]="Line",r[r.Polygon=3]="Polygon"})(me||(me={}));function U(e){return e.x+":"+e.y+":"+e.z}var Ri=(e,t,i)=>{e.pos=t;for(var r=e.readVarint()+e.pos,a=1,n=0,s=0,l=0,o=1/0,h=-1/0,d=1/0,x=-1/0,c=[],y;e.pos<r;){if(n<=0){var b=e.readVarint();a=b&7,n=b>>3}if(n--,a===1||a===2)s+=e.readSVarint()*i,l+=e.readSVarint()*i,s<o&&(o=s),s>h&&(h=s),l<d&&(d=l),l>x&&(x=l),a===1&&(y&&c.push(y),y=[]),y.push(new Se.default(s,l));else if(a===7)y&&y.push(y[0].clone());else throw new Error("unknown command "+a)}return y&&c.push(y),{geom:c,bbox:{minX:o,minY:d,maxX:h,maxY:x}}};function Mt(e,t){let i=new zt.VectorTile(new kt.default(e)),r=new Map;for(let[a,n]of Object.entries(i.layers)){let s=[],l=n;for(let o=0;o<l.length;o++){let h=Ri(l.feature(o)._pbf,l.feature(o)._geometry,t/l.extent),d=0;for(let x of h.geom)d+=x.length;s.push({id:l.feature(o).id,geomType:l.feature(o).type,geom:h.geom,numVertices:d,bbox:h.bbox,properties:l.feature(o).properties})}r.set(a,s)}return r}var Z=class{constructor(t){t.url?this.p=t:this.p=new ce(t),this.controllers=[]}get(t,i){return D(this,null,function*(){this.controllers=this.controllers.filter(s=>s[0]!=t.z?(s[1].abort(),!1):!0);let r=yield this.p.getZxy(t.z,t.x,t.y);if(!r)throw new Error(`Tile ${t.z} ${t.x} ${t.y} not found in archive`);let a=new AbortController;this.controllers.push([t.z,a]);let n=a.signal;return new Promise((s,l)=>{fetch(this.p.url,{headers:{Range:"bytes="+r[0]+"-"+(r[0]+r[1]-1)},signal:n}).then(o=>o.arrayBuffer()).then(o=>{let h=Mt(o,i);s(h)}).catch(o=>{l(o)})})})}},xe=class{constructor(t){this.url=t,this.controllers=[]}get(t,i){return D(this,null,function*(){this.controllers=this.controllers.filter(s=>s[0]!=t.z?(s[1].abort(),!1):!0);let r=this.url.replace("{z}",t.z.toString()).replace("{x}",t.x.toString()).replace("{y}",t.y.toString()),a=new AbortController;this.controllers.push([t.z,a]);let n=a.signal;return new Promise((s,l)=>{fetch(r,{signal:n}).then(o=>o.arrayBuffer()).then(o=>{let h=Mt(o,i);s(h)}).catch(o=>{l(o)})})})}},Ze=6378137,Lt=85.0511287798,Te=Ze*Math.PI,Vi=e=>{let t=Math.PI/180,i=Math.max(Math.min(Lt,e[0]),-Lt),r=Math.sin(i*t);return new Se.default(Ze*e[1]*t,Ze*Math.log((1+r)/(1-r))/2)},pe=class{constructor(t,i){this.source=t,this.cache=new Map,this.inflight=new Map,this.tileSize=i}queryFeatures(t,i,r){let a=Vi([i,t]);var n=new Se.default((a.x+Te)/(Te*2),1-(a.y+Te)/(Te*2));n.x>1&&(n.x=n.x-Math.floor(n.x));let s=n.mult(1<<r),l=Math.floor(s.x),o=Math.floor(s.y),h=U({z:r,x:l,y:o}),d=[],x=this.cache.get(h);if(x){let c=(s.x-l)*this.tileSize,y=(s.y-o)*this.tileSize,b={minX:c-8,minY:y-8,maxX:c+8,maxY:y+8};for(let[g,u]of x.data.entries())for(let f of u)b.maxX>=f.bbox.minX&&f.bbox.maxX>=b.minX&&b.maxY>=f.bbox.minY&&f.bbox.maxY>=b.minY&&d.push(f)}return d}get(t){return D(this,null,function*(){let i=U(t);return new Promise((r,a)=>{let n=this.cache.get(i);if(n)n.used=performance.now(),r(n.data);else{let s=this.inflight.get(i);s?s.push([r,a]):(this.inflight.set(i,[]),this.source.get(t,this.tileSize).then(l=>{this.cache.set(i,{used:performance.now(),data:l});let o=this.inflight.get(i);if(o&&o.forEach(h=>h[0](l)),this.inflight.delete(i),r(l),this.cache.size>=64){let h=1/0,d;this.cache.forEach((x,c)=>{x.used<h&&(d=c)}),d&&this.cache.delete(d)}}).catch(l=>{let o=this.inflight.get(i);o&&o.forEach(h=>h[1](l)),this.inflight.delete(i),a(l)}))}})})}};var W=V(A()),Be=(e,t,i)=>{let r=[];for(let a of e){let n=[];for(let s of a)n.push(s.clone().mult(t).add(i));r.push(n)}return r},ye=class{constructor(t,i,r){this.tileCache=t,this.maxDataLevel=i,this.levelDiff=r}dataTilesForBounds(t,i){let r=[];var a=1,n=this.tileCache.tileSize;if(t<this.levelDiff)a=1/(1<<this.levelDiff-t),r.push({data_tile:{z:0,x:0,y:0},origin:new W.default(0,0),scale:a,dim:n*a});else if(t<=this.levelDiff+this.maxDataLevel){let o=1<<this.levelDiff,h=Math.floor(i.minX/o/256),d=Math.floor(i.minY/o/256),x=Math.floor(i.maxX/o/256),c=Math.floor(i.maxY/o/256);for(var s=h;s<=x;s++)for(var l=d;l<=c;l++){let y=new W.default(s*o*256,l*o*256);r.push({data_tile:{z:t-this.levelDiff,x:s,y:l},origin:y,scale:1,dim:n})}}else{let o=1<<this.levelDiff;a=1<<t-this.maxDataLevel-this.levelDiff;let h=Math.floor(i.minX/o/256/a),d=Math.floor(i.minY/o/256/a),x=Math.floor(i.maxX/o/256/a),c=Math.floor(i.maxY/o/256/a);for(var s=h;s<=x;s++)for(var l=d;l<=c;l++){let g=new W.default(s*o*256*a,l*o*256*a);r.push({data_tile:{z:this.maxDataLevel,x:s,y:l},origin:g,scale:a,dim:n*a})}}return r}dataTileForDisplayTile(t){var i,r=1,a=this.tileCache.tileSize,n;if(t.z<this.levelDiff)i={z:0,x:0,y:0},r=1/(1<<this.levelDiff-t.z),n=new W.default(0,0),a=a*r;else if(t.z<=this.levelDiff+this.maxDataLevel){let s=1<<this.levelDiff;i={z:t.z-this.levelDiff,x:Math.floor(t.x/s),y:Math.floor(t.y/s)},n=new W.default(i.x*s*256,i.y*s*256)}else{r=1<<t.z-this.maxDataLevel-this.levelDiff;let s=1<<this.levelDiff;i={z:this.maxDataLevel,x:Math.floor(t.x/s/r),y:Math.floor(t.y/s/r)},n=new W.default(i.x*s*r*256,i.y*s*r*256),a=a*r}return{data_tile:i,scale:r,origin:n,dim:a}}getBbox(t,i){return D(this,null,function*(){let r=this.dataTilesForBounds(t,i);return(yield Promise.all(r.map(n=>this.tileCache.get(n.data_tile)))).map((n,s)=>{let l=r[s];return{data:n,z:t,data_tile:l.data_tile,scale:l.scale,dim:l.dim,origin:l.origin}})})}getDisplayTile(t){return D(this,null,function*(){let i=this.dataTileForDisplayTile(t);return{data:yield this.tileCache.get(i.data_tile),z:t.z,data_tile:i.data_tile,scale:i.scale,origin:i.origin,dim:i.dim}})}queryFeatures(t,i,r){return this.tileCache.queryFeatures(t,i,Math.min(r-this.levelDiff,this.maxDataLevel))}};var St=V(A());function Pe(e,t,i,r,a,n,s,l){let o=performance.now();e.save(),e.miterLimit=2;for(var h of t){let g=h.origin,u=h.scale;e.save(),s&&(e.beginPath(),e.rect(g.x-n.x,g.y-n.y,h.dim,h.dim),e.clip()),e.translate(g.x-n.x,g.y-n.y);for(var d of r)if(!(d.minzoom&&h.z<d.minzoom)&&!(d.maxzoom&&h.z>d.maxzoom)){var x=h.data.get(d.dataLayer);if(x!==void 0){d.symbolizer.before(e,h.z);for(var c of x){let f=c.geom,m=c.bbox;if(m.maxX*u+g.x<a.minX||m.minX*u+g.x>a.maxX||m.minY*u+g.y>a.maxY||m.maxY*u+g.y<a.minY)continue;let w=c.properties;d.filter&&!d.filter(w)||(u!=1&&(f=Be(f,u,new St.default(0,0))),d.symbolizer.draw(e,f,w))}}}e.restore()}let y=i.searchBbox(a,1/0);for(var b of y)if(e.save(),e.translate(b.anchor.x-n.x,b.anchor.y-n.y),b.draw(e),e.restore(),l){e.lineWidth=.5,e.strokeStyle=l,e.fillStyle=l,e.globalAlpha=1,e.fillRect(b.anchor.x-n.x-2,b.anchor.y-n.y-2,4,4);for(let g of b.bboxes)e.strokeRect(g.minX-n.x,g.minY-n.y,g.maxX-g.minX,g.maxY-g.minY)}return e.restore(),performance.now()-o}var Bt=V(Tt()),Ii=(e,t,i)=>{let r=256,a=t/r,n=Math.floor(i.minX/r),s=Math.floor(i.minY/r),l=Math.floor(i.maxX/r),o=Math.floor(i.maxY/r),h=Math.log2(a),d=[];for(let x=n;x<=l;x++)for(let c=s;c<=o;c++)d.push({display:U({z:e,x,y:c}),key:U({z:e-h,x:Math.floor(x/a),y:Math.floor(c/a)})});return d},Pt=class{constructor(){this.tree=new Bt.default,this.current=new Map}has(t){return this.current.has(t)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(t,i){let r=new Set;for(let a of this.tree.search(t))a.indexed_label.order<=i&&r.add(a.indexed_label);return r}searchLabel(t,i){let r=new Set;for(let a of t.bboxes)for(let n of this.tree.search(a))n.indexed_label.order<=i&&r.add(n.indexed_label);return r}bboxCollides(t,i){for(let r of this.tree.search(t))if(r.indexed_label.order<=i)return!0;return!1}labelCollides(t,i){for(let r of t.bboxes)for(let a of this.tree.search(r))if(a.indexed_label.order<=i)return!0;return!1}insert(t,i,r){let a={anchor:t.anchor,bboxes:t.bboxes,draw:t.draw,order:i,tileKey:r},n=this.current.get(r);if(n)n.add(a);else{let l=new Set;l.add(a),this.current.set(r,l)}for(let l of t.bboxes){var s=l;s.indexed_label=a,this.tree.insert(s)}}prune(t){let i=this.current.get(t);if(!i)return;let r=[];for(let a of this.tree.all())i.has(a.indexed_label)&&r.push(a);r.forEach(a=>{this.tree.remove(a)}),this.current.delete(t)}removeLabel(t){let i=[];for(let a of this.tree.all())t==a.indexed_label&&i.push(a);i.forEach(a=>{this.tree.remove(a)});let r=this.current.get(t.tileKey);r&&r.delete(t)}},Ce=class{constructor(t,i,r,a){this.index=new Pt,this.z=t,this.scratch=i,this.labelRules=r,this.callback=a}layout(t){let i=performance.now(),r=U(t.data_tile),a=new Set;for(let[s,l]of this.labelRules.entries()){if(l.visible==!1||l.minzoom&&this.z<l.minzoom||l.maxzoom&&this.z>l.maxzoom)continue;let o=t.data.get(l.dataLayer);if(o===void 0)continue;let h=o;l.sort&&h.sort((x,c)=>l.sort?l.sort(x.properties,c.properties):0);let d={index:this.index,zoom:this.z,scratch:this.scratch,order:s};for(let x of h){if(l.filter&&!l.filter(x.properties))continue;let c=Be(x.geom,t.scale,t.origin),y=l.symbolizer.place(d,c,x);if(!!y)for(let b of y){var n=!1;if(this.index.labelCollides(b,1/0)){if(!this.index.labelCollides(b,s)){let g=this.index.searchLabel(b,1/0);for(let u of g){this.index.removeLabel(u);for(let f of u.bboxes)this.findInvalidatedTiles(a,t.dim,f,r)}this.index.insert(b,s,r),n=!0}}else this.index.insert(b,s,r),n=!0;if(n)for(let g of b.bboxes)(g.maxX>t.origin.x+t.dim||g.minX<t.origin.x||g.minY<t.origin.y||g.maxY>t.origin.y+t.dim)&&this.findInvalidatedTiles(a,t.dim,g,r)}}}return a.size>0&&this.callback&&this.callback(a),performance.now()-i}findInvalidatedTiles(t,i,r,a){let n=Ii(this.z,i,r);for(let s of n)s.key!=a&&this.index.has(s.key)&&t.add(s.display)}pruneCache(t){if(this.index.size()>16){let i,r=0;for(let a of this.index.keys()){let n=a.split(":"),s=Math.sqrt(Math.pow(+n[0]-t.data_tile.x,2)+Math.pow(+n[1]-t.data_tile.y,2));s>r&&(r=s,i=a)}i&&this.index.prune(i)}}add(t){let i=U(t.data_tile);if(this.index.has(i))return 0;{let r=this.layout(t);return this.pruneCache(t),r}}},De=class{constructor(t,i,r){this.labelers=new Map,this.scratch=t,this.labelRules=i,this.callback=r}add(t){var i=this.labelers.get(t.z);return i||(i=new Ce(t.z,this.scratch,this.labelRules,this.callback),this.labelers.set(t.z,i)),i.add(t)}getIndex(t){let i=this.labelers.get(t);if(i)return i.index}};var re={earth:"#FFFBF6",glacier:"#ffffff",residential:"#F4F4F8",hospital:"#FFF6F6",cemetery:"#EFF2EE",school:"#F7F6FF",industrial:"#FFF9EF",wood:"#F4F9EF",grass:"#EBF9E3",park:"#E5F9D5",water:"#B7DFF2",sand:"#ebebeb",buildings:"#F2EDE8",highwayCasing:"#FFC3C3",majorRoadCasing:"#FFB9B9",mediumRoadCasing:"#FFCE8E",minorRoadCasing:"#cccccc",highway:"#FFCEBB",majorRoad:"#FFE4B3",mediumRoad:"#FFF2C8",minorRoad:"#ffffff",boundaries:"#9e9e9e",mask:"#dddddd",countryLabel:"#aaaaaa",cityLabel:"#6C6C6C",stateLabel:"#999999",neighbourhoodLabel:"#888888",landuseLabel:"#898989",waterLabel:"#41ABDC",naturalLabel:"#4B8F14",roadsLabel:"#888888",poisLabel:"#606060"};var ne={earth:"#151515",glacier:"#1c1c1c",residential:"#252B2F",hospital:"#3E2C2C",cemetery:"#36483D",school:"#2C3440",industrial:"#33312C",wood:"#3A3E38",grass:"#4E604D",park:"#2C4034",water:"#4D5B73",sand:"#777777",buildings:"#464545",highwayCasing:"#000000",majorRoadCasing:"#1C1B1B",mediumRoadCasing:"#3E3E3E",minorRoadCasing:"#000000",highway:"#5B5B5B",majorRoad:"#595959",mediumRoad:"#4F4F4F",minorRoad:"#393939",boundaries:"#666666",mask:"#dddddd",countryLabel:"#ffffff",cityLabel:"#FFFFFF",stateLabel:"#ffffff",neighbourhoodLabel:"#FDFDFD",landuseLabel:"#DDDDDD",waterLabel:"#707E95",naturalLabel:"#4c4c4c",roadsLabel:"#C4C4C4",poisLabel:"#959393"};var q=V(A());var qt=V(Xt());function Qe(e){if(e.length<=15)return[e];let t=e.lastIndexOf(" ",14),i=e.indexOf(" ",14);if(t==-1&&i==-1)return[e];let r,a;return i==-1||t>=0&&14-t<i-14?(r=e.substring(0,t),a=e.substring(t+1,e.length)):(r=e.substring(0,i),a=e.substring(i+1,e.length)),[r,...Qe(a)]}var ji="\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DB5\u4E00-\u9FEA\uF900-\uFA6D\uFA70-\uFAD9\u2000",Xr=new RegExp("^["+ji+"]+$");var O=class{constructor(t={}){this.properties=t.properties||["name"],this.textTransform=t.textTransform}str(t,i){var r;for(let a of this.properties)if(i.hasOwnProperty(a)){r=i[a];break}return r&&this.textTransform==="uppercase"&&(r=r.toUpperCase()),r}},N=class{constructor(t){t.font?this.font=t.font:(this.family=t.fontFamily||"sans-serif",this.size=t.fontSize||12,this.weight=t.fontWeight,this.style=t.fontStyle)}str(t,i){if(this.font)return typeof this.font=="function"?this.font(t,i):this.font;var r="";this.style&&(typeof this.style=="function"?r=this.style(t,i)+" ":r=this.style+" ");var a="";this.weight&&(typeof this.weight=="function"?a=this.weight(t,i)+" ":a=this.weight+" ");var n;typeof this.size=="function"?n=this.size(t,i):n=this.size;var s;return typeof this.family=="function"?s=this.family(t,i):s=this.family,`${r}${a}${n}px ${s}`}};var Vt=V(Rt());function It(e,t){let i,r,a=0;for(let n of e){let s=(0,Vt.default)(n,Math.PI/2/18);for(let l of s)l.length>=t&&l.length>a&&(a=l.length,i=n[l.beginIndex],r=n[l.endIndex-1])}if(!!i&&!(i.x==r.x&&i.y==r.y))return{start:i,end:r}}function Et(e,t,i,r){let a=t.x-e.x,n=t.y-e.y,s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),l=[];for(var o=r;o<i;o+=2*r){let h=o*1/s;l.push({x:e.x+h*a,y:e.y+h*n})}return l}var Ui=(e,t,i)=>{let r=document.createElement("canvas"),a=r.getContext("2d");return r.width=e,r.height=t,i(r,a),r},B=class{constructor(t){this.fill=t.fill||"#000000",this.opacity=t.opacity||1,this.pattern=t.pattern}before(t){this.pattern?t.fillStyle=t.createPattern(this.pattern,"repeat"):t.fillStyle=this.fill,t.globalAlpha=this.opacity}draw(t,i,r){t.beginPath();for(var a of i)for(var n=0;n<a.length-1;n++){let s=a[n];n==0?t.moveTo(s.x,s.y):t.lineTo(s.x,s.y)}t.fill()}};function Zi(e,t){return i=>{let r=i-e;return r>=0&&r<t.length?t[r]:0}}function X(e,t){return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[t.length-1][0])return t[t.length-1][1];let r=0;for(;t[r+1][0]<i;)r++;let a=t[r+1][0]-t[r][0],n=i-t[r][0];var s;return a===0?s=0:e===1?s=n/a:s=(Math.pow(e,n)-1)/(Math.pow(e,a)-1),s*(t[r+1][1]-t[r][1])+t[r][1]}}function Wi(e){return!!(e&&e.constructor&&e.call&&e.apply)}var C=class{constructor(t){this.color=t.color||"#000000",this.width=t.width||1,this.opacity=t.opacity||1,this.skip=!1,this.dash=t.dash,this.dashColor=t.dashColor||"black",this.dashWidth=t.dashWidth||1}before(t,i){if(t.strokeStyle=this.color,t.globalAlpha=this.opacity,Wi(this.width)&&this.width.length==1){let r=this.width(i);this.skip=r===0,t.lineWidth=r}else t.lineWidth=this.width}draw(t,i,r){if(!this.skip){t.beginPath();for(var a of i)for(var n=0;n<a.length;n++){let s=a[n];n==0?t.moveTo(s.x,s.y):t.lineTo(s.x,s.y)}this.dash?(t.save(),t.lineWidth=this.dashWidth,t.strokeStyle=this.dashColor,t.setLineDash(this.dash),t.stroke(),t.restore()):t.stroke()}}},At=class{constructor(t){this.sprites=t.sprites,this.name=t.name}place(t,i,r){let a=i[0],n=new q.default(i[0][0].x,i[0][0].y),s={minX:n.x-32,minY:n.y-32,maxX:n.x+32,maxY:n.y+32};return[{anchor:n,bboxes:[s],draw:o=>{o.globalAlpha=1;let h=this.sprites.get(this.name);o.drawImage(h.canvas,h.x,h.y,h.w,h.h,-8,-8,h.w,h.h)}}]}},be=class{constructor(t){this.radius=t.radius||3,this.fill=t.fill||"black",this.stroke=t.stroke||"white",this.width=t.width||0}place(t,i,r){let a=i[0],n=new q.default(i[0][0].x,i[0][0].y),s={minX:n.x-this.radius,minY:n.y-this.radius,maxX:n.x+this.radius,maxY:n.y+this.radius};return[{anchor:n,bboxes:[s],draw:o=>{o.globalAlpha=1,this.width>0&&(o.fillStyle=this.stroke,o.beginPath(),o.arc(0,0,this.radius+this.width,0,2*Math.PI),o.fill()),o.fillStyle=this.fill,o.beginPath(),o.arc(0,0,this.radius,0,2*Math.PI),o.fill()}}]}},Ye=class{constructor(t){this.font=new N(t),this.text=new O(t),this.fill=t.fill||"black",this.stroke=t.stroke||"white",this.background=t.background||"white",this.padding=t.padding||0}place(t,i,r){let a=this.text.str(t.zoom,r.properties);if(!a)return;let n=this.font.str(t.zoom,r.properties);t.scratch.font=n;let s=t.scratch.measureText(a),l=s.width,o=s.actualBoundingBoxAscent,h=s.actualBoundingBoxDescent,d=i[0],x=new q.default(i[0][0].x,i[0][0].y),c=this.padding,y={minX:x.x-l/2-c,minY:x.y-o-c,maxX:x.x+l/2+c,maxY:x.y+h+c};return[{anchor:x,bboxes:[y],draw:g=>{g.globalAlpha=1,g.fillStyle=this.background,g.fillRect(-l/2-c,-o-c,l+2*c,o+h+2*c),g.fillStyle=this.fill,g.font=n,g.fillText(a,-l/2,0)}}]}},ge=class{constructor(t,i){this.list=t}place(t,i,r){var a=this.list[0].place(t,i,r);if(!a)return;var n=a[0];let s=n.anchor,l=n.bboxes[0],o=l.maxY-l.minY,h=[{draw:n.draw,translate:{x:0,y:0}}],d=[[{x:i[0][0].x,y:i[0][0].y+o}]];for(let c=1;c<this.list.length;c++)a=this.list[c].place(t,d,r),a&&(n=a[0],l=$t(l,n.bboxes[0]),h.push({draw:n.draw,translate:{x:0,y:o}}));return[{anchor:s,bboxes:[l],draw:c=>{for(let y of h)c.save(),c.translate(y.translate.x,y.translate.y),y.draw(c),c.restore()}}]}},$t=(e,t)=>({minX:Math.min(e.minX,t.minX),minY:Math.min(e.minY,t.minY),maxX:Math.max(e.maxX,t.maxX),maxY:Math.max(e.maxY,t.maxY)}),we=class{constructor(t){this.list=t}place(t,i,r){let a=this.list[0];if(!a)return;var n=a.place(t,i,r);if(!n)return;var s=n[0];let l=s.anchor,o=s.bboxes[0],h=[s.draw];for(let x=1;x<this.list.length;x++){if(n=this.list[x].place(t,i,r),!n)return;s=n[0],o=$t(o,s.bboxes[0]),h.push(s.draw)}return[{anchor:l,bboxes:[o],draw:x=>{h.forEach(c=>c(x))}}]}},I=class{constructor(t){this.font=new N(t),this.text=new O(t),this.fill=t.fill,this.stroke=t.stroke||"black",this.width=t.width||0}place(t,i,r){if(r.geomType!==me.Point)return;let a=this.text.str(t.zoom,r.properties);if(!a)return;let n=this.font.str(t.zoom,r.properties);t.scratch.font=n;let s=t.scratch.measureText(a),l=s.width,o=s.actualBoundingBoxAscent,h=s.actualBoundingBoxDescent,d=new q.default(i[0][0].x,i[0][0].y),x={minX:d.x-l/2,minY:d.y-o,maxX:d.x+l/2,maxY:d.y+h},c=-l/2;return[{anchor:d,bboxes:[x],draw:b=>{b.globalAlpha=1,b.font=n,this.width&&(b.lineWidth=this.width*2,b.strokeStyle=this.stroke,b.strokeText(a,c,0)),b.fillStyle=this.fill,b.fillText(a,c,0)}}]}},H=class{constructor(t){this.font=new N(t),this.text=new O(t),this.fill=t.fill,this.stroke=t.stroke||"black",this.width=t.width||0,this.offset=t.offset||0}place(t,i,r){if(r.geomType!==me.Point)return;let a=this.text.str(t.zoom,r.properties);if(!a)return;let n=this.font.str(t.zoom,r.properties);t.scratch.font=n;let s=t.scratch.measureText(a),l=s.width,o=s.actualBoundingBoxAscent,h=s.actualBoundingBoxDescent,d=new q.default(i[0][0].x,i[0][0].y),x=this.offset;var c=new q.default(x,-x);let y=g=>{g.globalAlpha=1,g.font=n,this.width&&(g.lineWidth=this.width*2,g.strokeStyle=this.stroke,g.strokeText(a,c.x,c.y)),g.fillStyle=this.fill,g.fillText(a,c.x,c.y)};var b={minX:d.x+c.x,minY:d.y-o+c.y,maxX:d.x+l+c.x,maxY:d.y+h+c.y};if(!t.index.bboxCollides(b,t.order))return[{anchor:d,bboxes:[b],draw:y}];if(c=new q.default(-l-x,-x),b={minX:d.x+c.x,minY:d.y-o+c.y,maxX:d.x+l+c.x,maxY:d.y+h+c.y},!t.index.bboxCollides(b,t.order))return[{anchor:d,bboxes:[b],draw:y}]}},ae=class{constructor(t){this.font=new N(t),this.text=new O(t),this.fill=t.fill||"black",this.stroke=t.stroke||"black",this.width=t.width||0,this.offset=t.offset||0}place(t,i,r){let a=this.text.str(t.zoom,r.properties);if(!a||a.length>20)return;let n=r.bbox;if((n.maxY-n.minY)*(n.maxX-n.minX)<400)return;let l=this.font.str(t.zoom,r.properties);t.scratch.font=l;let h=t.scratch.measureText(a).width,d=It(i,h);if(!d)return;let x=d.end.x-d.start.x,c=d.end.y-d.start.y,y=8,g=Et(d.start,d.end,h,8).map(f=>({minX:f.x-y,minY:f.y-y,maxX:f.x+y,maxY:f.y+y})),u=f=>{f.globalAlpha=1,f.rotate(Math.atan2(c,x)),x<0&&(f.scale(-1,-1),f.translate(-h,0)),f.translate(0,-this.offset),f.font=l,this.width&&(f.lineWidth=this.width,f.strokeStyle=this.stroke,f.strokeText(a,0,0)),f.fillStyle=this.fill,f.fillText(a,0,0)};return[{anchor:d.start,bboxes:g,draw:u}]}},se=class{constructor(t){this.font=new N(t),this.text=new O(t),this.fill=t.fill||"black",this.stroke=t.stroke||"black",this.width=t.width||0}place(t,i,r){let a=r.bbox;if((a.maxY-a.minY)*(a.maxX-a.minX)<2e4)return;let s=this.text.str(t.zoom,r.properties);if(!s)return;let l=i[0],o=(0,qt.default)([l.map(p=>[p.x,p.y])]),h=new q.default(o[0],o[1]),d=this.font.str(t.zoom,r.properties);t.scratch.font=d;let x=Qe(s),c=14;var y,b=0;for(let p of x)p.length>b&&(b=p.length,y=p);let g=t.scratch.measureText(y),u=g.width,f={minX:h.x-u/2,minY:h.y-g.actualBoundingBoxAscent,maxX:h.x+u/2,maxY:h.y+(c*x.length-g.actualBoundingBoxAscent)},m=this.fill;return[{anchor:h,bboxes:[f],draw:p=>{p.globalAlpha=1,p.font=d;var v=0;for(let _ of x)this.width&&(p.lineWidth=this.width,p.strokeStyle=this.stroke,p.strokeText(_,-u/2,v)),p.fillStyle=m,p.fillText(_,-u/2,v),v+=c}}]}};function ve(e,t,i){return Math.min(Math.max(e,i),t)}var le=class extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}};function Oi(e){if(typeof e!="string")throw new le(e);if(e.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=e.trim();t=Ki.test(e)?function(s){let l=s.toLowerCase().trim(),o=Ni[function(h){let d=5381,x=h.length;for(;x;)d=33*d^h.charCodeAt(--x);return(d>>>0)%2341}(l)];if(!o)throw new le(s);return`#${o}`}(e):e;let i=Hi.exec(t);if(i){let s=Array.from(i).slice(1);return[...s.slice(0,3).map(l=>parseInt(_e(l,2),16)),parseInt(_e(s[3]||"f",2),16)/255]}let r=Gi.exec(t);if(r){let s=Array.from(r).slice(1);return[...s.slice(0,3).map(l=>parseInt(l,16)),parseInt(s[3]||"ff",16)/255]}let a=Qi.exec(t);if(a){let s=Array.from(a).slice(1);return[...s.slice(0,3).map(l=>parseInt(l,10)),parseFloat(s[3]||"1")]}let n=Ji.exec(t);if(n){let[s,l,o,h]=Array.from(n).slice(1).map(parseFloat);if(ve(0,100,l)!==l)throw new le(e);if(ve(0,100,o)!==o)throw new le(e);return[...er(s,l,o),h||1]}throw new le(e)}var jt=e=>parseInt(e.replace(/_/g,""),36),Ni="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((e,t)=>{let i=jt(t.substring(0,3)),r=jt(t.substring(3)).toString(16),a="";for(let n=0;n<6-r.length;n++)a+="0";return e[i]=`${a}${r}`,e},{}),_e=(e,t)=>Array.from(Array(t)).map(()=>e).join(""),Hi=new RegExp(`^#${_e("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Gi=new RegExp(`^#${_e("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Qi=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${_e(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),Ji=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,Ki=/^[a-z]+$/i,Ut=e=>Math.round(255*e),er=(e,t,i)=>{let r=i/100;if(t===0)return[r,r,r].map(Ut);let a=(e%360+360)%360/60,n=(1-Math.abs(2*r-1))*(t/100),s=n*(1-Math.abs(a%2-1)),l=0,o=0,h=0;a>=0&&a<1?(l=n,o=s):a>=1&&a<2?(l=s,o=n):a>=2&&a<3?(o=n,h=s):a>=3&&a<4?(o=s,h=n):a>=4&&a<5?(l=s,h=n):a>=5&&a<6&&(l=n,h=s);let d=r-n/2;return[l+d,o+d,h+d].map(Ut)};function Je(e){let[t,i,r,a]=Oi(e).map((h,d)=>d===3?h:h/255),n=Math.max(t,i,r),s=Math.min(t,i,r),l=(n+s)/2;if(n===s)return[0,0,l,a];let o=n-s;return[60*(t===n?(i-r)/o+(i<r?6:0):i===n?(r-t)/o+2:(t-i)/o+4),l>.5?o/(2-n-s):o/(n+s),l,a]}function Zt(e,t,i,r){return`hsla(${(e%360).toFixed()}, ${ve(0,100,100*t).toFixed()}%, ${ve(0,100,100*i).toFixed()}%, ${parseFloat(ve(0,1,r).toFixed(3))})`}var Wt=(e,t)=>{let i=Je(t),r=at({},e);for(let[a,n]of Object.entries(e)){let s=Je(n);r[a]=Zt(i[0],i[1],s[2],s[3])}return r},oe=(e,t)=>(t&&(e=Wt(e,t)),[{dataLayer:"earth",symbolizer:new B({fill:e.earth})},{dataLayer:"natural",symbolizer:new B({fill:e.glacier}),filter:i=>i.natural=="glacier"},{dataLayer:"landuse",symbolizer:new B({fill:e.residential}),filter:i=>i.landuse=="residential"||i.place=="neighbourhood"},{dataLayer:"landuse",symbolizer:new B({fill:e.hospital}),filter:i=>i.amenity=="hospital"},{dataLayer:"landuse",symbolizer:new B({fill:e.cemetery}),filter:i=>i.landuse=="cemetery"},{dataLayer:"landuse",symbolizer:new B({fill:e.school}),filter:i=>i.amenity=="school"||i.amenity=="kindergarten"||i.amenity=="university"||i.amenity=="college"},{dataLayer:"landuse",symbolizer:new B({fill:e.industrial}),filter:i=>i.landuse=="industrial"},{dataLayer:"natural",symbolizer:new B({fill:e.wood}),filter:i=>i.natural=="wood"},{dataLayer:"landuse",symbolizer:new B({fill:e.grass}),filter:i=>i.landuse=="grass"},{dataLayer:"landuse",symbolizer:new B({fill:e.park}),filter:i=>i.leisure=="park"},{dataLayer:"water",symbolizer:new B({fill:e.water})},{dataLayer:"natural",symbolizer:new B({fill:e.sand}),filter:i=>i.natural=="sand"},{dataLayer:"buildings",symbolizer:new B({fill:e.buildings})},{dataLayer:"roads",symbolizer:new C({color:e.highwayCasing,width:X(1.4,[[5,1.5],[11,4],[16,9],[20,40]])}),filter:i=>i["pmap:kind"]=="highway"},{dataLayer:"roads",symbolizer:new C({color:e.majorRoadCasing,width:X(1.4,[[9,3],[12,4],[17,8],[20,22]])}),filter:i=>i["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new C({color:e.mediumRoadCasing,width:X(1.4,[[13,3],[17,6],[20,18]])}),filter:i=>i["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new C({color:e.minorRoadCasing,width:X(1.4,[[14,2],[17,5],[20,15]])}),filter:i=>i["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new C({color:e.minorRoad,width:X(1.4,[[14,1],[17,3],[20,13]])}),filter:i=>i["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new C({color:e.mediumRoad,width:X(1.4,[[13,2],[17,4],[20,15]])}),filter:i=>i["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new C({color:e.majorRoad,width:X(1.4,[[9,2],[12,3],[17,6],[20,20]])}),filter:i=>i["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new C({color:e.highway,width:X(1.4,[[5,.5],[11,2.5],[16,7],[20,30]])}),filter:i=>i["pmap:kind"]=="highway"},{dataLayer:"boundaries",symbolizer:new C({color:e.boundaries,width:2,opacity:.4})},{dataLayer:"mask",symbolizer:new B({fill:e.mask})}]),he=(e,t,i,r)=>{t&&(e=Wt(e,t));var a=["name"];i&&(a=i);let n=(s,l)=>r?s instanceof H?new ge([s,new H({fill:l,properties:r})],{}):new ge([s,new I({fill:l,properties:r})],{}):s;return[{dataLayer:"places",symbolizer:n(new I({properties:a,fill:e.countryLabel,font:(s,l)=>s<6?"200 14px sans-serif":"200 20px sans-serif",textTransform:"uppercase"}),e.countryLabel),filter:s=>s["pmap:kind"]=="country"},{dataLayer:"places",symbolizer:n(new I({properties:a,fill:e.stateLabel,font:"300 16px sans-serif"}),e.stateLabel),filter:s=>s["pmap:kind"]=="state"},{id:"cities_high",dataLayer:"places",filter:s=>s["pmap:kind"]=="city",minzoom:7,symbolizer:n(new I({properties:a,fill:e.cityLabel,font:(s,l)=>l["pmap:rank"]==1?s>8?"600 20px sans-serif":"600 12px sans-serif":s>8?"600 16px sans-serif":"600 10px sans-serif"}),e.cityLabel),sort:(s,l)=>s["pmap:rank"]-l["pmap:rank"]},{id:"cities_low",dataLayer:"places",filter:s=>s["pmap:kind"]=="city",maxzoom:6,symbolizer:new we([new be({radius:2,fill:e.cityLabel}),n(new H({properties:a,fill:e.cityLabel,offset:2,font:(s,l)=>l["pmap:rank"]==1?s>8?"600 20px sans-serif":"600 12px sans-serif":s>8?"600 16px sans-serif":"600 10px sans-serif"}),e.cityLabel)]),sort:(s,l)=>s["pmap:rank"]-l["pmap:rank"]},{id:"neighbourhood",dataLayer:"places",symbolizer:n(new I({properties:a,fill:e.neighbourhoodLabel,font:"500 10px sans-serif",textTransform:"uppercase"}),e.neighbourhoodLabel),filter:s=>s["pmap:kind"]=="neighbourhood"},{dataLayer:"landuse",symbolizer:n(new se({properties:a,fill:e.landuseLabel,font:"300 12px sans-serif"}),e.landuseLabel)},{dataLayer:"water",symbolizer:n(new se({properties:a,fill:e.waterLabel,font:"italic 600 12px sans-serif"}),e.waterLabel)},{dataLayer:"natural",symbolizer:n(new se({properties:a,fill:e.naturalLabel,font:"italic 300 12px sans-serif"}),e.naturalLabel)},{dataLayer:"roads",symbolizer:n(new ae({properties:a,fill:e.roadsLabel,font:"500 12px sans-serif"}),e.roadsLabel),minzoom:12},{dataLayer:"roads",symbolizer:new Ye({properties:["ref"],font:"600 9px sans-serif",background:e.highway,padding:2,fill:e.neighbourhoodLabel}),filter:s=>s["pmap:kind"]=="highway"},{dataLayer:"pois",symbolizer:new we([new be({radius:2,fill:e.poisLabel}),n(new H({properties:a,fill:e.poisLabel,offset:2,font:"300 10px sans-serif"}),e.poisLabel)])}]};var Ke=6378137,Ot=85.0511287798,Ve=Ke*Math.PI,tr=e=>{let t=Math.PI/180,i=Math.max(Math.min(Ot,e[0]),-Ot),r=Math.sin(i*t);return new Re.default(Ke*e[1]*t,Ke*Math.log((1+r)/(1-r))/2)},Nt=class{constructor(t){let i=t.dark?ne:re;this.paint_rules=t.paint_rules||oe(i,t.shade),this.label_rules=t.label_rules||he(i,t.shade,t.language1,t.language2);let r;t.url.url?r=new Z(t.url):t.url.endsWith(".pmtiles")?r=new Z(t.url):r=new xe(t.url);let a=new pe(r,1024);this.view=new ye(a,14,2),this.debug=t.debug||!1}drawContext(t,i,r,a,n){return D(this,null,function*(){let s=tr(a),o=new Re.default((s.x+Ve)/(Ve*2),1-(s.y+Ve)/(Ve*2)).clone().mult((1<<n)*256).sub(new Re.default(i/2,r/2)),h={minX:o.x,minY:o.y,maxX:o.x+i,maxY:o.y+r},d=yield this.view.getBbox(n,h),x=performance.now(),c=new Ce(n,t,this.label_rules,void 0);for(var y of d)yield c.add(y);let b=Pe(t,d,c.index,this.paint_rules,h,o,!0,this.debug);if(this.debug){t.save(),t.translate(-o.x,-o.y);for(var y of d)t.strokeStyle="black",t.strokeRect(y.origin.x,y.origin.y,y.dim,y.dim);t.restore()}return performance.now()-x})}drawCanvas(n,s,l){return D(this,arguments,function*(t,i,r,a={}){let o=window.devicePixelRatio,h=t.clientWidth,d=t.clientHeight;t.sizeSet||(t.width=h*o,t.height=d*o,t.sizeSet=!0),t.lang=a.lang;let x=t.getContext("2d");return x.setTransform(o,0,0,o,0,0),this.drawContext(x,h,d,i,r)})}};var Ht=V(A());var Gt=class{constructor(t){this.lang=t,this.unused=[]}get(t){if(this.unused.length){let r=this.unused.shift();return r.removed=!1,r}let i=L.DomUtil.create("canvas","leaflet-tile");return i.width=t,i.height=t,i.lang=this.lang,i}put(t){L.DomUtil.removeClass(t,"leaflet-tile-loaded"),this.unused.push(t)}},ir=e=>new Promise((t,i)=>{setTimeout(()=>{t()},e)}),rr=e=>{class t extends L.GridLayer{constructor(r){r.noWrap&&!r.bounds&&(r.bounds=[[-90,-180],[90,180]]),r.attribution||(r.attribution='<a href="https://protomaps.com">Protomaps</a> \xA9 <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(r);let a=r.dark?ne:re;this.paint_rules=r.paint_rules||oe(a,r.shade),this.label_rules=r.label_rules||he(a,r.shade,r.language1,r.language2),this.lastRequestedZ=void 0;let n;r.url.url?n=new Z(r.url):r.url.endsWith(".pmtiles")?n=new Z(r.url):n=new xe(r.url),this.tasks=r.tasks||[];let s=new pe(n,1024);this.view=new ye(s,14,2),this.debug=r.debug;let l=document.createElement("canvas").getContext("2d");this.scratch=l,this.onTilesInvalidated=o=>{o.forEach(h=>{this.rerenderTile(h)})},this.labelers=new De(this.scratch,this.label_rules,this.onTilesInvalidated),this.tile_size=256*window.devicePixelRatio,this.pool=new Gt(r.lang)}setDefaultStyle(r,a,n,s){let l=r?ne:re;this.paint_rules=oe(l,a),this.label_rules=he(l,a,n,s)}renderTile(r,a,n,s=()=>{}){return D(this,null,function*(){this.lastRequestedZ=r.z;var l;try{l=yield this.view.getDisplayTile(r)}catch(p){if(p.name=="AbortError")return;throw p}if(a.key!=n||this.lastRequestedZ!==r.z||(yield Promise.allSettled(this.tasks),a.key!=n)||this.lastRequestedZ!==r.z)return;let o=yield this.labelers.add(l);if(a.key!=n||this.lastRequestedZ!==r.z)return;let h=this.labelers.getIndex(l.z);if(!this._map)return;let d=this._map.getCenter().wrap(),x=this._getTiledPixelBounds(d),c=this._pxBoundsToTileRange(x),y=c.getCenter(),b=r.distanceTo(y)*5;if(yield ir(b),a.key!=n||this.lastRequestedZ!==r.z)return;let g=16,u={minX:256*r.x-g,minY:256*r.y-g,maxX:256*(r.x+1)+g,maxY:256*(r.y+1)+g},f=new Ht.default(256*r.x,256*r.y),m=a.getContext("2d");m.setTransform(this.tile_size/256,0,0,this.tile_size/256,0,0),m.clearRect(0,0,256,256);let w=Pe(m,[l],h,this.paint_rules,u,f,!1,this.debug);if(this.debug){let p=l.data_tile;m.save(),m.fillStyle=this.debug,m.font="600 12px sans-serif",m.fillText(r.z+" "+r.x+" "+r.y,4,14),m.font="200 12px sans-serif",m.fillText(p.z+" "+p.x+" "+p.y,4,28),m.font="600 10px sans-serif",w>8&&m.fillText(w.toFixed()+" ms paint",4,42),o>8&&m.fillText(o.toFixed()+" ms layout",4,56),m.strokeStyle=this.debug,m.lineWidth=r.x/4===p.x?1.5:.5,m.beginPath(),m.moveTo(0,0),m.lineTo(0,256),m.stroke(),m.lineWidth=r.y/4===p.y?1.5:.5,m.beginPath(),m.moveTo(0,0),m.lineTo(256,0),m.stroke(),m.restore()}s()})}rerenderTile(r){for(let a in this._tiles){let n=this._wrapCoords(this._keyToTileCoords(a));r===this._tileCoordsToKey(n)&&this.renderTile(n,this._tiles[a].el,r)}}clearLayout(){this.labelers=new De(this.scratch,this.label_rules,this.onTilesInvalidated)}rerenderTiles(){for(let r in this._tiles){let a=this._wrapCoords(this._keyToTileCoords(r)),n=this._tileCoordsToKey(a);this.renderTile(a,this._tiles[r].el,n)}}createTile(r,a){let n=this.pool.get(this.tile_size),s=this._tileCoordsToKey(r);return n.key=s,this.renderTile(r,n,s,()=>{a(null,n)}),n}_removeTile(r){let a=this._tiles[r];!a||(a.el.removed=!0,a.el.key=void 0,L.DomUtil.remove(a.el),this.pool.put(a.el),delete this._tiles[r],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(r)}))}queryFeatures(r,a){return this.view.queryFeatures(r,a,this._map.getZoom())}}return new t(e)};var nr=e=>{let t=0,i=0;for(let l of e)t+=l.w*l.h,i=Math.max(i,l.w);e.sort((l,o)=>o.h-l.h);let r=Math.max(Math.ceil(Math.sqrt(t/.95)),i),a=[{x:0,y:0,w:r,h:1/0}],n=0,s=0;for(let l of e)for(let o=a.length-1;o>=0;o--){let h=a[o];if(!(l.w>h.w||l.h>h.h)){if(l.x=h.x,l.y=h.y,s=Math.max(s,l.y+l.h),n=Math.max(n,l.x+l.w),l.w===h.w&&l.h===h.h){let d=a.pop();o<a.length&&(a[o]=d)}else l.h===h.h?(h.x+=l.w,h.w-=l.w):l.w===h.w?(h.y+=l.h,h.h-=l.h):(a.push({x:h.x+l.w,y:h.y,w:h.w-l.w,h:l.h}),h.y+=l.h,h.h-=l.h);break}}return{w:n,h:s,fill:t/(n*s)||0}},Qt=e=>new Promise((t,i)=>{let r=new Image;r.onload=()=>t(r),r.onerror=()=>i("Invalid SVG"),r.src=e}),ar=`
<svg width="20px" height="20px" viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <rect width="50" height="50" fill="#cccccc"/>
    <g transform="translate(5,5)">
        <path fill="none" stroke="#666666" stroke-width="7" d="m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7"/>
    </g>
</svg>
`,Ie=class{constructor(t){this.src=t,this.canvas=null}load(){return D(this,null,function*(){let t=this.src,i=window.devicePixelRatio;t.endsWith(".html")&&(t=yield(yield fetch(t)).text());let a=new window.DOMParser().parseFromString(t,"text/html").body.children;this.mapping={};let n=yield Qt("data:image/svg+xml;base64,"+btoa(ar)),s=[{w:n.width*i,h:n.height*i,img:n}],l=new XMLSerializer;for(let c of a){var o=btoa(l.serializeToString(c)),h="data:image/svg+xml;base64,"+o;let y=yield Qt(h);s.push({w:y.width*i,h:y.height*i,img:y,id:c.id})}let d=nr(s);this.canvas=document.createElement("canvas"),this.canvas.width=d.w,this.canvas.height=d.h;let x=this.canvas.getContext("2d");for(let c of s)x.drawImage(c.img,c.x,c.y,c.w,c.h),c.id?this.mapping[c.id]={x:c.x,y:c.y,w:c.w,h:c.h}:this.missingBox={x:c.x,y:c.y,w:c.w,h:c.h};return this})}get(t){let i=this.mapping[t];return i||(i=this.missingBox),i.canvas=this.canvas,i}};var sr=(e,t,i)=>{let r=new FontFace(e,"url("+t+")",{weight:i});return document.fonts.add(r),r.load()},lr=e=>new Ie(e);function Fe(e){if(e.includes("$type"))return t=>!0;if(e[0]=="==")return t=>t[e[1]]===e[2];if(e[0]=="!=")return t=>t[e[1]]!==e[2];if(e[0]=="!"){let t=Fe(e[1]);return i=>!t(i)}else{if(e[0]==="<")return t=>t[e[1]]<e[2];if(e[0]==="<=")return t=>t[e[1]]<=e[2];if(e[0]===">")return t=>t[e[1]]>e[2];if(e[0]===">=")return t=>t[e[1]]>=e[2];if(e[0]==="in")return t=>e.slice(2,e.length).includes(t[e[1]]);if(e[0]==="!in")return t=>!e.slice(2,e.length).includes(t[e[1]]);if(e[0]==="has")return t=>t.hasOwnProperty(e[1]);if(e[0]==="all"){let t=e.slice(1,e.length).map(i=>Fe(i));return i=>t.every(r=>r(i))}else if(e[0]==="any"){let t=e.slice(1,e.length).map(i=>Fe(i));return i=>t.some(r=>r(i))}else return console.log("Unimplemented filter: ",e[0]),t=>!1}}function Ee(e){if(e.base&&e.stops)return(i,r)=>X(e.base,e.stops)(i-1);if(e[0]=="interpolate"&&e[1][0]=="exponential"&&e[2]=="zoom"){let i=e.slice(3),r=[];for(var t=0;t<i.length;t+=2)r.push([i[t],i[t+1]]);return a=>X(e[1][1],r)(a-1)}else if(e[0]=="step"&&e[1][0]=="get"){let i=e.slice(2),r=e[1][1];return(a,n)=>{let s=n[r];if(s<i[1])return i[0];for(t=1;t<i.length;t+=2)if(s<=i[t])return i[t+1];return i[i.length-1]}}else return console.log("Unimplemented numeric fn: ",e),i=>1}function et(e,t=0){return e?typeof e=="number"?e:Ee(e):t}function tt(e,t){let i=et(e,1),r=et(t);return a=>{let n=typeof i=="number"?i:i(a,{});return r?n+(typeof r=="number"?r:r(a,{})):n}}function it(e,t){let i=[];for(let l of e["text-font"])t.hasOwnProperty(l)&&i.push(t[l]);i.length===0&&i.push({face:"sans-serif"});let r=e["text-size"];var a="";i.length&&i[0].weight&&(a=i[0].weight+" ");var n="";if(i.length&&i[0].style&&(n=i[0].style+" "),typeof r=="number")return`${n}${a}${r}px ${i.map(l=>l.face).join(", ")}`;if(r.stops){var s=1.4;r.base&&(s=r.base);let l=Ee(r);return o=>`${n}${a}${l(o,{})}px ${i.map(h=>h.face).join(", ")}`}else if(r[0]=="step"){let l=Ee(r);return(o,h)=>`${n}${a}${l(o,h)}px ${i.map(d=>d.face).join(", ")}`}else return console.log("Can't parse font: ",e),(l,o)=>"12px sans-serif"}function or(e,t){let i=[],r=[],a=new Map;for(var n of e.layers){if(a.set(n.id,n),n.layout&&n.layout.visibility=="none")continue;if(n.ref){let h=a.get(n.ref);n.type=h.type,n.filter=h.filter,n.source=h.source,n["source-layer"]=h["source-layer"]}let o=n["source-layer"];var s,l=void 0;n.filter&&(l=Fe(n.filter)),n.type=="fill"?i.push({dataLayer:n["source-layer"],filter:l,symbolizer:new B({fill:n.paint["fill-color"],opacity:n.paint["fill-opacity"]})}):n.type=="fill-extrusion"?i.push({dataLayer:n["source-layer"],filter:l,symbolizer:new B({fill:n.paint["fill-extrusion-color"],opacity:n.paint["fill-extrusion-opacity"]})}):n.type=="line"?n.paint["line-dasharray"]?i.push({dataLayer:n["source-layer"],filter:l,symbolizer:new C({width:tt(n.paint["line-width"],n.paint["line-gap-width"]),dash:n.paint["line-dasharray"],dashColor:n.paint["line-color"]})}):i.push({dataLayer:n["source-layer"],filter:l,symbolizer:new C({color:n.paint["line-color"],width:tt(n.paint["line-width"],n.paint["line-gap-width"])})}):n.type=="symbol"&&(n.layout["symbol-placement"]=="line"?r.push({dataLayer:n["source-layer"],filter:l,symbolizer:new ae({font:it(n.layout,t),fill:n.paint["text-color"],width:n.paint["text-halo-width"],stroke:n.paint["text-halo-color"],textTransform:n.layout["text-transform"]})}):r.push({dataLayer:n["source-layer"],filter:l,symbolizer:new I({font:it(n.layout,t),fill:n.paint["text-color"],stroke:n.paint["text-halo-color"],width:n.paint["text-halo-width"],textTransform:n.layout["text-transform"]})}))}return r.reverse(),{paint_rules:i,label_rules:r,tasks:[]}}return hr;})();
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
