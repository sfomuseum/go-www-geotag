var protomaps=(()=>{var Bt=Object.create,ne=Object.defineProperty,Dt=Object.getPrototypeOf,Ct=Object.prototype.hasOwnProperty,Pt=Object.getOwnPropertyNames,Vt=Object.getOwnPropertyDescriptor;var Rt=(t,e,i)=>e in t?ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Xt=t=>ne(t,"__esModule",{value:!0});var Y=(t,e)=>()=>(e||(e={exports:{}},t(e.exports,e)),e.exports),Yt=(t,e)=>{for(var i in e)ne(t,i,{get:e[i],enumerable:!0})},Et=(t,e,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Pt(e))!Ct.call(t,r)&&r!=="default"&&ne(t,r,{get:()=>e[r],enumerable:!(i=Vt(e,r))||i.enumerable});return t},E=t=>Et(Xt(ne(t!=null?Bt(Dt(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var H=(t,e,i)=>(Rt(t,typeof e!="symbol"?e+"":e,i),i);var C=(t,e,i)=>new Promise((r,n)=>{var s=l=>{try{o(i.next(l))}catch(u){n(u)}},a=l=>{try{o(i.throw(l))}catch(u){n(u)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,a);o((i=i.apply(t,e)).next())});var $=Y((Si,Ne)=>{"use strict";Ne.exports=Q;function Q(t,e){this.x=t,this.y=e}Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,n=i*this.x+e*this.y;return this.x=r,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.x+i*(this.x-e.x)-r*(this.y-e.y),s=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=n,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};Q.convert=function(t){return t instanceof Q?t:Array.isArray(t)?new Q(t[0],t[1]):t}});var Me=Y((_i,We)=>{"use strict";var It=$();We.exports=G;function G(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(Ut,this,e)}function Ut(t,e,i){t==1?e.id=i.readVarint():t==2?Zt(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function Zt(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}G.types=["Unknown","Point","LineString","Polygon"];G.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,s=0,a=[],o;t.pos<e;){if(r<=0){var l=t.readVarint();i=l&7,r=l>>3}if(r--,i===1||i===2)n+=t.readSVarint(),s+=t.readSVarint(),i===1&&(o&&a.push(o),o=[]),o.push(new It(n,s));else if(i===7)o&&o.push(o[0].clone());else throw new Error("unknown command "+i)}return o&&a.push(o),a};G.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,s=0,a=Infinity,o=-Infinity,l=Infinity,u=-Infinity;t.pos<e;){if(r<=0){var c=t.readVarint();i=c&7,r=c>>3}if(r--,i===1||i===2)n+=t.readSVarint(),s+=t.readSVarint(),n<a&&(a=n),n>o&&(o=n),s<l&&(l=s),s>u&&(u=s);else if(i!==7)throw new Error("unknown command "+i)}return[a,l,o,u]};G.prototype.toGeoJSON=function(t,e,i){var r=this.extent*Math.pow(2,i),n=this.extent*t,s=this.extent*e,a=this.loadGeometry(),o=G.types[this.type],l,u;function c(v){for(var m=0;m<v.length;m++){var F=v[m],h=180-(F.y+s)*360/r;v[m]=[(F.x+n)*360/r-180,360/Math.PI*Math.atan(Math.exp(h*Math.PI/180))-90]}}switch(this.type){case 1:var x=[];for(l=0;l<a.length;l++)x[l]=a[l][0];a=x,c(a);break;case 2:for(l=0;l<a.length;l++)c(a[l]);break;case 3:for(a=At(a),l=0;l<a.length;l++)for(u=0;u<a[l].length;u++)c(a[l][u]);break}a.length===1?a=a[0]:o="Multi"+o;var g={type:"Feature",geometry:{type:o,coordinates:a},properties:this.properties};return"id"in this&&(g.id=this.id),g};function At(t){var e=t.length;if(e<=1)return[t];for(var i=[],r,n,s=0;s<e;s++){var a=qt(t[s]);a!==0&&(n===void 0&&(n=a<0),n===a<0?(r&&i.push(r),r=[t[s]]):r.push(t[s]))}return r&&i.push(r),i}function qt(t){for(var e=0,i=0,r=t.length,n=r-1,s,a;i<r;n=i++)s=t[i],a=t[n],e+=(a.x-s.x)*(s.y+a.y);return e}});var Se=Y((zi,He)=>{"use strict";var jt=Me();He.exports=Qe;function Qe(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ot,this,e),this.length=this._features.length}function Ot(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(Nt(i))}function Nt(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=r===1?t.readString():r===2?t.readFloat():r===3?t.readDouble():r===4?t.readVarint64():r===5?t.readVarint():r===6?t.readSVarint():r===7?t.readBoolean():null}return e}Qe.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new jt(this._pbf,e,this.extent,this._keys,this._values)}});var Ge=Y((ki,$e)=>{"use strict";var Wt=Se();$e.exports=Ht;function Ht(t,e){this.layers=t.readFields(Qt,{},e)}function Qt(t,e,i){if(t===3){var r=new Wt(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}});var Je=Y((Ti,ue)=>{ue.exports.VectorTile=Ge();ue.exports.VectorTileFeature=Me();ue.exports.VectorTileLayer=Se()});var Ke=Y(_e=>{_e.read=function(t,e,i,r,n){var s,a,o=n*8-r-1,l=(1<<o)-1,u=l>>1,c=-7,x=i?n-1:0,g=i?-1:1,v=t[e+x];for(x+=g,s=v&(1<<-c)-1,v>>=-c,c+=o;c>0;s=s*256+t[e+x],x+=g,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=r;c>0;a=a*256+t[e+x],x+=g,c-=8);if(s===0)s=1-u;else{if(s===l)return a?NaN:(v?-1:1)*Infinity;a=a+Math.pow(2,r),s=s-u}return(v?-1:1)*a*Math.pow(2,s-r)};_e.write=function(t,e,i,r,n,s){var a,o,l,u=s*8-n-1,c=(1<<u)-1,x=c>>1,g=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=r?0:s-1,m=r?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===Infinity?(o=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+x>=1?e+=g/l:e+=g*Math.pow(2,1-x),e*l>=2&&(a++,l/=2),a+x>=c?(o=0,a=c):a+x>=1?(o=(e*l-1)*Math.pow(2,n),a=a+x):(o=e*Math.pow(2,x-1)*Math.pow(2,n),a=0));n>=8;t[i+v]=o&255,v+=m,o/=256,n-=8);for(a=a<<n|o,u+=n;u>0;t[i+v]=a&255,v+=m,a/=256,u-=8);t[i+v-m]|=F*128}});var st=Y((Di,et)=>{"use strict";et.exports=z;var ce=Ke();function z(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}z.Varint=0;z.Fixed64=1;z.Bytes=2;z.Fixed32=5;var ze=(1<<16)*(1<<16),tt=1/ze,$t=12,it=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");z.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=r&7,t(n,e,this),this.pos===s&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=de(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=nt(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=de(this.buf,this.pos)+de(this.buf,this.pos+4)*ze;return this.pos+=8,t},readSFixed64:function(){var t=de(this.buf,this.pos)+nt(this.buf,this.pos+4)*ze;return this.pos+=8,t},readFloat:function(){var t=ce.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ce.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,r;return r=e[this.pos++],i=r&127,r<128||(r=e[this.pos++],i|=(r&127)<<7,r<128)||(r=e[this.pos++],i|=(r&127)<<14,r<128)||(r=e[this.pos++],i|=(r&127)<<21,r<128)?i:(r=e[this.pos],i|=(r&15)<<28,Gt(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=$t&&it?hi(this.buf,e,t):li(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==z.Bytes)return t.push(this.readVarint(e));var i=I(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==z.Bytes)return t.push(this.readSVarint());var e=I(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==z.Bytes)return t.push(this.readBoolean());var e=I(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==z.Bytes)return t.push(this.readFloat());var e=I(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==z.Bytes)return t.push(this.readDouble());var e=I(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==z.Bytes)return t.push(this.readFixed32());var e=I(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==z.Bytes)return t.push(this.readSFixed32());var e=I(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==z.Bytes)return t.push(this.readFixed64());var e=I(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==z.Bytes)return t.push(this.readSFixed64());var e=I(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===z.Varint)for(;this.buf[this.pos++]>127;);else if(e===z.Bytes)this.pos=this.readVarint()+this.pos;else if(e===z.Fixed32)this.pos+=4;else if(e===z.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),J(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),J(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),J(this.buf,t&-1,this.pos),J(this.buf,Math.floor(t*tt),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),J(this.buf,t&-1,this.pos),J(this.buf,Math.floor(t*tt),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){Jt(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=fi(this.buf,t,this.pos);var i=this.pos-e;i>=128&&rt(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),ce.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ce.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&rt(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,z.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Kt,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,ei,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ri,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,ti,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ii,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,ni,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,si,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,ai,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,oi,e)},writeBytesField:function(t,e){this.writeTag(t,z.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,z.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,z.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,z.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,z.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,z.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,z.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,z.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,z.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,z.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function Gt(t,e,i){var r=i.buf,n,s;if(s=r[i.pos++],n=(s&112)>>4,s<128||(s=r[i.pos++],n|=(s&127)<<3,s<128)||(s=r[i.pos++],n|=(s&127)<<10,s<128)||(s=r[i.pos++],n|=(s&127)<<17,s<128)||(s=r[i.pos++],n|=(s&127)<<24,s<128)||(s=r[i.pos++],n|=(s&1)<<31,s<128))return K(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function I(t){return t.type===z.Bytes?t.readVarint()+t.pos:t.pos+1}function K(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function Jt(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),ui(i,r,e),ci(r,e)}function ui(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function ci(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127)))))}function rt(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function Kt(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function ei(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function ti(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function ii(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function ri(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function ni(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function si(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function ai(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function oi(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function de(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function J(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function nt(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function li(t,e,i){for(var r="",n=e;n<i;){var s=t[n],a=null,o=s>239?4:s>223?3:s>191?2:1;if(n+o>i)break;var l,u,c;o===1?s<128&&(a=s):o===2?(l=t[n+1],(l&192)==128&&(a=(s&31)<<6|l&63,a<=127&&(a=null))):o===3?(l=t[n+1],u=t[n+2],(l&192)==128&&(u&192)==128&&(a=(s&15)<<12|(l&63)<<6|u&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):o===4&&(l=t[n+1],u=t[n+2],c=t[n+3],(l&192)==128&&(u&192)==128&&(c&192)==128&&(a=(s&15)<<18|(l&63)<<12|(u&63)<<6|c&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,o=1):a>65535&&(a-=65536,r+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),r+=String.fromCharCode(a),n+=o}return r}function hi(t,e,i){return it.decode(t.subarray(e,i))}function fi(t,e,i){for(var r=0,n,s;r<e.length;r++){if(n=e.charCodeAt(r),n>55295&&n<57344)if(s)if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):s=n;continue}else s&&(t[i++]=239,t[i++]=191,t[i++]=189,s=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=n&63|128)}return i}});var ct=Y((Ce,Pe)=>{(function(t,e){typeof Ce=="object"&&typeof Pe!="undefined"?Pe.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(Ce,function(){"use strict";function t(h,f,d,p,y){(function w(b,M,S,_,T){for(;_>S;){if(_-S>600){var k=_-S+1,D=M-S+1,ie=Math.log(k),q=.5*Math.exp(2*ie/3),N=.5*Math.sqrt(ie*q*(k-q)/k)*(D-k/2<0?-1:1),W=Math.max(S,Math.floor(M-D*q/k+N)),Tt=Math.min(_,Math.floor(M+(k-D)*q/k+N));w(b,M,W,Tt,T)}var fe=b[M],re=S,X=_;for(e(b,S,M),T(b[_],fe)>0&&e(b,S,_);re<X;){for(e(b,re,X),re++,X--;T(b[re],fe)<0;)re++;for(;T(b[X],fe)>0;)X--}T(b[S],fe)===0?e(b,S,X):e(b,++X,_),X<=M&&(S=X+1),M<=X&&(_=X-1)}})(h,f,d||0,p||h.length-1,y||i)}function e(h,f,d){var p=h[f];h[f]=h[d],h[d]=p}function i(h,f){return h<f?-1:h>f?1:0}var r=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(h,f,d){if(!d)return f.indexOf(h);for(var p=0;p<f.length;p++)if(d(h,f[p]))return p;return-1}function s(h,f){a(h,0,h.children.length,f,h)}function a(h,f,d,p,y){y||(y=m(null)),y.minX=1/0,y.minY=1/0,y.maxX=-1/0,y.maxY=-1/0;for(var w=f;w<d;w++){var b=h.children[w];o(y,h.leaf?p(b):b)}return y}function o(h,f){return h.minX=Math.min(h.minX,f.minX),h.minY=Math.min(h.minY,f.minY),h.maxX=Math.max(h.maxX,f.maxX),h.maxY=Math.max(h.maxY,f.maxY),h}function l(h,f){return h.minX-f.minX}function u(h,f){return h.minY-f.minY}function c(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function x(h){return h.maxX-h.minX+(h.maxY-h.minY)}function g(h,f){return h.minX<=f.minX&&h.minY<=f.minY&&f.maxX<=h.maxX&&f.maxY<=h.maxY}function v(h,f){return f.minX<=h.maxX&&f.minY<=h.maxY&&f.maxX>=h.minX&&f.maxY>=h.minY}function m(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function F(h,f,d,p,y){for(var w=[f,d];w.length;)if(!((d=w.pop())-(f=w.pop())<=p)){var b=f+Math.ceil((d-f)/p/2)*p;t(h,b,f,d,y),w.push(f,b,b,d)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(h){var f=this.data,d=[];if(!v(h,f))return d;for(var p=this.toBBox,y=[];f;){for(var w=0;w<f.children.length;w++){var b=f.children[w],M=f.leaf?p(b):b;v(h,M)&&(f.leaf?d.push(b):g(h,M)?this._all(b,d):y.push(b))}f=y.pop()}return d},r.prototype.collides=function(h){var f=this.data;if(!v(h,f))return!1;for(var d=[];f;){for(var p=0;p<f.children.length;p++){var y=f.children[p],w=f.leaf?this.toBBox(y):y;if(v(h,w)){if(f.leaf||g(h,w))return!0;d.push(y)}}f=d.pop()}return!1},r.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var f=0;f<h.length;f++)this.insert(h[f]);return this}var d=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===d.height)this._splitRoot(this.data,d);else{if(this.data.height<d.height){var p=this.data;this.data=d,d=p}this._insert(d,this.data.height-d.height-1,!0)}else this.data=d;return this},r.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},r.prototype.clear=function(){return this.data=m([]),this},r.prototype.remove=function(h,f){if(!h)return this;for(var d,p,y,w=this.data,b=this.toBBox(h),M=[],S=[];w||M.length;){if(w||(w=M.pop(),p=M[M.length-1],d=S.pop(),y=!0),w.leaf){var _=n(h,w.children,f);if(_!==-1)return w.children.splice(_,1),M.push(w),this._condense(M),this}y||w.leaf||!g(w,b)?p?(d++,w=p.children[d],y=!1):w=null:(M.push(w),S.push(d),d=0,p=w,w=w.children[0])}return this},r.prototype.toBBox=function(h){return h},r.prototype.compareMinX=function(h,f){return h.minX-f.minX},r.prototype.compareMinY=function(h,f){return h.minY-f.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(h){return this.data=h,this},r.prototype._all=function(h,f){for(var d=[];h;)h.leaf?f.push.apply(f,h.children):d.push.apply(d,h.children),h=d.pop();return f},r.prototype._build=function(h,f,d,p){var y,w=d-f+1,b=this._maxEntries;if(w<=b)return s(y=m(h.slice(f,d+1)),this.toBBox),y;p||(p=Math.ceil(Math.log(w)/Math.log(b)),b=Math.ceil(w/Math.pow(b,p-1))),(y=m([])).leaf=!1,y.height=p;var M=Math.ceil(w/b),S=M*Math.ceil(Math.sqrt(b));F(h,f,d,S,this.compareMinX);for(var _=f;_<=d;_+=S){var T=Math.min(_+S-1,d);F(h,_,T,M,this.compareMinY);for(var k=_;k<=T;k+=M){var D=Math.min(k+M-1,T);y.children.push(this._build(h,k,D,p-1))}}return s(y,this.toBBox),y},r.prototype._chooseSubtree=function(h,f,d,p){for(;p.push(f),!f.leaf&&p.length-1!==d;){for(var y=1/0,w=1/0,b=void 0,M=0;M<f.children.length;M++){var S=f.children[M],_=c(S),T=(k=h,D=S,(Math.max(D.maxX,k.maxX)-Math.min(D.minX,k.minX))*(Math.max(D.maxY,k.maxY)-Math.min(D.minY,k.minY))-_);T<w?(w=T,y=_<y?_:y,b=S):T===w&&_<y&&(y=_,b=S)}f=b||f.children[0]}var k,D;return f},r.prototype._insert=function(h,f,d){var p=d?h:this.toBBox(h),y=[],w=this._chooseSubtree(p,this.data,f,y);for(w.children.push(h),o(w,p);f>=0&&y[f].children.length>this._maxEntries;)this._split(y,f),f--;this._adjustParentBBoxes(p,y,f)},r.prototype._split=function(h,f){var d=h[f],p=d.children.length,y=this._minEntries;this._chooseSplitAxis(d,y,p);var w=this._chooseSplitIndex(d,y,p),b=m(d.children.splice(w,d.children.length-w));b.height=d.height,b.leaf=d.leaf,s(d,this.toBBox),s(b,this.toBBox),f?h[f-1].children.push(b):this._splitRoot(d,b)},r.prototype._splitRoot=function(h,f){this.data=m([h,f]),this.data.height=h.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(h,f,d){for(var p,y,w,b,M,S,_,T=1/0,k=1/0,D=f;D<=d-f;D++){var ie=a(h,0,D,this.toBBox),q=a(h,D,d,this.toBBox),N=(y=ie,w=q,b=void 0,M=void 0,S=void 0,_=void 0,b=Math.max(y.minX,w.minX),M=Math.max(y.minY,w.minY),S=Math.min(y.maxX,w.maxX),_=Math.min(y.maxY,w.maxY),Math.max(0,S-b)*Math.max(0,_-M)),W=c(ie)+c(q);N<T?(T=N,p=D,k=W<k?W:k):N===T&&W<k&&(k=W,p=D)}return p||d-f},r.prototype._chooseSplitAxis=function(h,f,d){var p=h.leaf?this.compareMinX:l,y=h.leaf?this.compareMinY:u;this._allDistMargin(h,f,d,p)<this._allDistMargin(h,f,d,y)&&h.children.sort(p)},r.prototype._allDistMargin=function(h,f,d,p){h.children.sort(p);for(var y=this.toBBox,w=a(h,0,f,y),b=a(h,d-f,d,y),M=x(w)+x(b),S=f;S<d-f;S++){var _=h.children[S];o(w,h.leaf?y(_):_),M+=x(w)}for(var T=d-f-1;T>=f;T--){var k=h.children[T];o(b,h.leaf?y(k):k),M+=x(b)}return M},r.prototype._adjustParentBBoxes=function(h,f,d){for(var p=d;p>=0;p--)o(f[p],h)},r.prototype._condense=function(h){for(var f=h.length-1,d=void 0;f>=0;f--)h[f].children.length===0?f>0?(d=h[f-1].children).splice(d.indexOf(h[f]),1):this.clear():s(h[f],this.toBBox)},r})});var mt=Y((Xe,Ye)=>{(function(t,e){typeof Xe=="object"&&typeof Ye!="undefined"?Ye.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self,t.TinyQueue=e())})(Xe,function(){"use strict";var t=function(r,n){if(r===void 0&&(r=[]),n===void 0&&(n=e),this.data=r,this.length=this.data.length,this.compare=n,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};t.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var r=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),r}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(r){for(var n=this,s=n.data,a=n.compare,o=s[r];r>0;){var l=r-1>>1,u=s[l];if(a(o,u)>=0)break;s[r]=u,r=l}s[r]=o},t.prototype._down=function(r){for(var n=this,s=n.data,a=n.compare,o=this.length>>1,l=s[r];r<o;){var u=(r<<1)+1,c=s[u],x=u+1;if(x<this.length&&a(s[x],c)<0&&(u=x,c=s[x]),a(c,l)>=0)break;s[r]=c,r=u}s[r]=l};function e(i,r){return i<r?-1:i>r?1:0}return t})});var pt=Y((Zi,Ee)=>{"use strict";var ge=mt();ge.default&&(ge=ge.default);Ee.exports=yt;Ee.exports.default=yt;function yt(t,e,i){e=e||1;for(var r,n,s,a,o=0;o<t[0].length;o++){var l=t[0][o];(!o||l[0]<r)&&(r=l[0]),(!o||l[1]<n)&&(n=l[1]),(!o||l[0]>s)&&(s=l[0]),(!o||l[1]>a)&&(a=l[1])}var u=s-r,c=a-n,x=Math.min(u,c),g=x/2;if(x===0){var v=[r,n];return v.distance=0,v}for(var m=new ge(void 0,mi),F=r;F<s;F+=x)for(var h=n;h<a;h+=x)m.push(new U(F+g,h+g,g,t));var f=yi(t),d=new U(r+u/2,n+c/2,0,t);d.d>f.d&&(f=d);for(var p=m.length;m.length;){var y=m.pop();y.d>f.d&&(f=y,i&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,p)),!(y.max-f.d<=e)&&(g=y.h/2,m.push(new U(y.x-g,y.y-g,g,t)),m.push(new U(y.x+g,y.y-g,g,t)),m.push(new U(y.x-g,y.y+g,g,t)),m.push(new U(y.x+g,y.y+g,g,t)),p+=4)}i&&(console.log("num probes: "+p),console.log("best distance: "+f.d));var w=[f.x,f.y];return w.distance=f.d,w}function mi(t,e){return e.max-t.max}function U(t,e,i,r){this.x=t,this.y=e,this.h=i,this.d=pi(t,e,r),this.max=this.d+this.h*Math.SQRT2}function pi(t,e,i){for(var r=!1,n=Infinity,s=0;s<i.length;s++)for(var a=i[s],o=0,l=a.length,u=l-1;o<l;u=o++){var c=a[o],x=a[u];c[1]>e!=x[1]>e&&t<(x[0]-c[0])*(e-c[1])/(x[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,gi(t,e,c,x))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function yi(t){for(var e=0,i=0,r=0,n=t[0],s=0,a=n.length,o=a-1;s<a;o=s++){var l=n[s],u=n[o],c=l[0]*u[1]-u[0]*l[1];i+=(l[0]+u[0])*c,r+=(l[1]+u[1])*c,e+=c*3}return e===0?new U(n[0][0],n[0][1],0,t):new U(i/e,r/e,0,t)}function gi(t,e,i,r){var n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){var l=((t-n)*a+(e-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=t-n,o=e-s,a*a+o*o}});var wt=Y((Ai,gt)=>{gt.exports=function(t,e){var i=[],r=[null],n,s,a,o=0,l=0,u=0,c=0,x=0,g=0,v=0,m=0,F=0,h=0,f=0,d=0;if(t.length<2)return[];if(t.length===2)return u=Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),[{length:u,beginIndex:0,beginDistance:0,endIndex:2,endDistance:u,angles:[null,null]}];for(c=Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),o=1,l=t.length-1;o<l;o++)n=t[o-1],s=t[o],a=t[o+1],g=s.x-n.x,v=s.y-n.y,m=a.x-s.x,F=a.y-s.y,x=Math.sqrt(m*m+F*F),u+=c,h=Math.acos((g*m+v*F)/(c*x)),r.push(h),h>e&&(i.push({length:u-d,beginDistance:d,beginIndex:f,endIndex:o+1,endDistance:u,angles:r}),f=o,d=u,r=[h]),c=x;return r.push(null),o-f>0&&i.push({length:u-d+x,beginIndex:f,beginDistance:d,endIndex:o+1,endDistance:u+x,angles:r}),i}});var Li={};Yt(Li,{FillSymbolizer:()=>B,Font:()=>je,IconSymbolizer:()=>we,LeafletLayer:()=>Le,LineLabelSymbolizer:()=>Z,LineSymbolizer:()=>P,PMTiles:()=>ee,PolygonLabelSymbolizer:()=>A,Sprites:()=>Oe,Static:()=>Fe,TextSymbolizer:()=>R,exp:()=>V,json_style:()=>Ae});var ht=E(Je()),ft=E(st());var at=(t,e)=>t*Math.pow(2,e),ot=(t,e)=>at(t.getUint16(e+1,!0),8)+t.getUint8(e,!0),di=(t,e)=>at(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),xi=t=>{var e=t.getUint16(0,!0),i=t.getUint16(2,!0),r=t.getUint32(4,!0),n=t.getUint16(8,!0);return{version:i,json_size:r,root_entries:n}},lt=t=>{let e=new Map;for(var i=0;i<t.byteLength;i+=17){var r=t.getUint8(i,!0),n=r&127,s=r>>7,a=ot(t,i+1),o=ot(t,i+4),l=di(t,i+7),u=t.getUint32(i+13,!0);e.set(n+"_"+a+"_"+o,[l,u,s])}return e},ee=class{constructor(e){H(this,"metadata",e=>new Promise((i,r)=>{this.root.then(n=>{i(n.metadata)})}));H(this,"getLeaf",(e,i)=>new Promise((r,n)=>{this.leaves.has(e)?(this.leaves.get(e)[0]++,r(this.leaves.get(e)[1])):this.outstanding_requests.has(e)?this.outstanding_requests.get(e).push(r):(this.outstanding_requests.set(e,[]),fetch(this.url,{headers:{Range:"bytes="+e+"-"+(e+i-1)}}).then(s=>s.arrayBuffer()).then(s=>{var a=lt(new DataView(s),i/17);if(this.leaves.size>32){var o=Infinity,l=void 0;this.leaves.forEach((u,c)=>{u[0]<o&&(o=u[0],l=c)}),this.leaves.delete(l)}this.leaves.set(e,[this.step++,a]),r(a),this.outstanding_requests.get(e).forEach(u=>u(a)),this.outstanding_requests.delete(e)}))}));H(this,"getZxy",(e,i,r)=>{var n=e+"_"+i+"_"+r;return this.root.then(s=>{if(s.dir.has(n)&&s.dir.get(n)[2]==0)return s.dir.get(n);if(e>=7){var a=e-7,o=[7,Math.trunc(i/(1<<a)),Math.trunc(r/(1<<a))],l=o[0]+"_"+o[1]+"_"+o[2];if(s.dir.has(l)&&s.dir.get(l)[2]==1){let u=s.dir.get(l);return this.getLeaf(u[0],u[1]).then(c=>c.has(n)?c.get(n):null)}}return null})});H(this,"transformRequest",(e,i,r,n)=>{if(e.endsWith(".pmtiles")&&n){var s=r.tileID.canonical,a=s.z+"_"+s.x+"_"+s.y;this.getZxy(s.z,s.x,s.y).then(o=>{o&&n({url:this.url,headers:{Range:"bytes="+o[0]+"-"+(o[0]+o[1]-1)}})})}return{url:e}});H(this,"leafletLayer",e=>{let i=this;var r=L.GridLayer.extend({createTile:function(n,s){var a=document.createElement("img"),o;return i.getZxy(n.z,n.x,n.y).then(l=>{l!==null&&fetch(i.url,{headers:{Range:"bytes="+l[0]+"-"+(l[0]+l[1]-1)}}).then(u=>u.arrayBuffer()).then(u=>{var c=new Blob([u],{type:"image/png"}),x=window.URL.createObjectURL(c);a.src=x,s(o,a)})}),a},_removeTile:function(n){var s=this._tiles[n];!s||(s.el.width=0,s.el.height=0,s.el.deleted=!0,L.DomUtil.remove(s.el),delete this._tiles[n],this.fire("tileunload",{tile:s.el,coords:this._keyToTileCoords(n)}))}});return new r(e)});this.url=e;let i=new AbortController,r=i.signal;this.root=fetch(this.url,{signal:r,headers:{Range:"bytes=0-511999"}}).then(n=>(n.headers.get("Content-Length")!=512e3&&(console.error("Content-Length mismatch indicates byte serving not supported; aborting."),i.abort()),n.arrayBuffer())).then(n=>{let s=xi(new DataView(n,0,10));var a=new TextDecoder("utf-8");return{metadata:JSON.parse(a.decode(new DataView(n,10,s.json_size))),dir:lt(new DataView(n,10+s.json_size,17*s.root_entries))}}),this.step=0,this.leaves=new Map,this.outstanding_requests=new Map}};var xe;(function(t){t[t.Point=1]="Point",t[t.Line=2]="Line",t[t.Polygon=3]="Polygon"})(xe||(xe={}));function te(t){return t.x+":"+t.y+":"+t.z}function ut(t){let e=new ht.VectorTile(new ft.default(t)),i={};for(let[r,n]of Object.entries(e.layers)){let s=[],a=n;for(let o=0;o<a.length;o++){let l=a.feature(o).loadGeometry(),u=0;for(let c of l)u+=c.length;s.push({geomType:a.feature(o).type,geom:l,vertices:u,bbox:a.feature(o).bbox(),properties:a.feature(o).properties})}i[r]=s}return i}var me=class{constructor(e){e.url?this.p=e:this.p=new ee(e),this.controllers=[]}get(e){return C(this,null,function*(){this.controllers=this.controllers.filter(s=>s[0]!=e.z?(s[1].abort(),!1):!0);let i=yield this.p.getZxy(e.z,e.x,e.y),r=new AbortController;this.controllers.push([e.z,r]);let n=r.signal;return new Promise((s,a)=>{fetch(this.p.url,{headers:{Range:"bytes="+i[0]+"-"+(i[0]+i[1]-1)},signal:n}).then(o=>o.arrayBuffer()).then(o=>{let l=ut(o);s(l)}).catch(o=>{a(o)})})})}},se=class{constructor(e){this.url=e,this.controllers=[]}get(e){return C(this,null,function*(){this.controllers=this.controllers.filter(s=>s[0]!=e.z?(s[1].abort(),!1):!0);let i=this.url.replace("{z}",e.z.toString()).replace("{x}",e.x.toString()).replace("{y}",e.y.toString()),r=new AbortController;this.controllers.push([e.z,r]);let n=r.signal;return new Promise((s,a)=>{fetch(i,{signal:n}).then(o=>o.arrayBuffer()).then(o=>{let l=ut(o);s(l)}).catch(o=>{a(o)})})})}},ae=class{constructor(e){this.source=e,this.cache=new Map,this.inflight=new Map}get(e){return C(this,null,function*(){let i=te(e);return new Promise((r,n)=>{if(this.cache.has(i)){let s=this.cache.get(i);s.used=performance.now(),r(s.data)}else this.inflight.has(i)?this.inflight.get(i).push([r,n]):(this.inflight.set(i,[]),this.source.get(e).then(s=>{if(this.cache.set(i,{used:performance.now(),data:s}),this.inflight.get(i).forEach(a=>a[0](s)),this.inflight.delete(i),r(s),this.cache.size>=64){let a=Infinity,o;this.cache.forEach((l,u)=>{l.used<a&&(o=u)}),this.cache.delete(o)}}).catch(()=>{this.inflight.get(i).forEach(s=>s[1]("Cancel data "+i)),this.inflight.delete(i),n("Cancel data "+i)}))})})}};var j=E($()),ke=class{},Te=class extends ke{constructor(e,i,r){super();this.tileCache=e,this.dataResolution=r,this.maxDataLevel=i}get(){return C(this,null,function*(){let e=[{z:2,x:0,y:0},{z:2,x:0,y:1},{z:2,x:1,y:0},{z:2,x:1,y:1}];return(yield Promise.all(e.map(r=>this.tileCache.get(r)))).map((r,n)=>({data:r,bbox:[0,0,4096,4096],transform:{scale:.25,translate:new j.default(1024*e[n].x,1024*e[n].y)},tile:e[n],z:1}))})}},Be=class extends ke{constructor(e,i,r,n,s){super();this.tileCache=e,this.maxDataLevel=i,this.dataResolution=r,this.levelDiff=n,this.displayResolution=s}dataTile(e){var i;if(e.z<this.levelDiff)i={z:0,x:0,y:0};else if(e.z<=this.levelDiff+this.maxDataLevel){let n=1<<this.levelDiff;i={z:e.z-this.levelDiff,x:Math.floor(e.x/n),y:Math.floor(e.y/n)}}else{var r=1<<e.z-this.maxDataLevel;i={z:this.maxDataLevel,x:Math.floor(e.x/r),y:Math.floor(e.y/r)}}return i}covering(e,i,r){let n=1<<e-i.z,s=this.dataResolution,a={x:r.minX/s,y:r.minY/s},o={x:Math.floor(a.x*n),y:Math.floor(a.y*n)},l={x:r.maxX/s,y:r.maxY/s},u={x:Math.floor(l.x*n),y:Math.floor(l.y*n)},c=[];for(let x=o.x;x<=u.x;x++)for(let g=o.y;g<=u.y;g++)Math.floor(x/n)==i.x&&Math.floor(g/n)==i.y||c.push({z:e,x,y:g});return c}transform(e){let i=this.displayResolution;if(e.z<this.levelDiff){if(e.z==0)return{scale:.0625,translate:new j.default(0,0)};if(e.z==1)return{scale:.125,translate:new j.default(e.x*-i,e.y*-i)}}else if(e.z<=this.levelDiff+this.maxDataLevel){let r=this.dataTile(e),n=1<<this.levelDiff;return{scale:.25,translate:new j.default((e.x-r.x*n)*-i,(e.y-r.y*n)*-i)}}else{let r=this.dataTile(e),n=1<<e.z-(this.maxDataLevel+this.levelDiff),s=(1<<this.levelDiff)*n;return{scale:.25*n,translate:new j.default((e.x-r.x*s)*-i,(e.y-r.y*s)*-i)}}}point(e,i,r){let n=this.displayResolution;if(e.z<this.levelDiff)e.z==0,e.z==1;else if(e.z<=this.levelDiff+this.maxDataLevel){let s=this.dataTile(e),a=1<<this.levelDiff;return new j.default(((e.x-s.x*a)*n+i)*4,((e.y-s.y*a)*n+i)*4)}else{let s=this.dataTile(e),a=1<<e.z-(this.maxDataLevel+this.levelDiff),o=(1<<this.levelDiff)*a}}bbox(e){if(e.z<this.levelDiff)return[0,0,4096,4096];if(e.z<=this.levelDiff+this.maxDataLevel){let i=1<<this.levelDiff,r=this.dataTile(e),n=r.x*i,s=r.y*i,a=e.x-n,o=e.y-s;return[a*1024,o*1024,(a+1)*1024,(o+1)*1024]}else{let i=1024>>e.z-this.maxDataLevel-this.levelDiff,r=this.dataTile(e),n=1<<e.z-this.maxDataLevel,s=r.x*n,a=r.y*n,o=e.x-s,l=e.y-a;return[o*i,l*i,(o+1)*i,(l+1)*i]}}get(e){return C(this,null,function*(){let i=this.dataTile(e);return{data:yield this.tileCache.get(i),transform:this.transform(e),bbox:this.bbox(e),z:e.z,data_tile:i}})}within(e,i,r){return C(this,null,function*(){let n=this.dataTile(e),s=yield this.tileCache.get(n),a=this.point(e,i,r),o=[];for(let[l,u]of Object.entries(s))for(let c of u){let x=c.bbox;x[0]<a.x&&x[1]<a.y&&x[2]>a.x&&x[3]>a.y&&o.push([l,c])}return o})}};var De=E($());function ye(t,e,i,r,n,s){let a=performance.now(),o;if(t.ctx?o=t.ctx:(o=t.element.getContext("2d",{alpha:!1}),t.ctx=o),t.element&&t.element.key!=e)return;o.setTransform(t.tile_size/256,0,0,t.tile_size/256,0,0),o.save(),o.fillStyle="rgba(0,0,0,1)",o.globalCompositeOperation="destination-out",o.fillRect(0,0,256,256),o.restore(),o.miterLimit=1;for(var l of n){var u=i.data[l.dataLayer];if(u!==void 0){l.symbolizer.before(o,i.z);for(var c of u){var x=c.bbox,g=i.bbox;x[2]<g[0]||x[0]>g[2]||x[1]>g[3]||x[3]<g[1]||l.filter&&!l.filter(c.properties)||l.symbolizer.draw(o,c.geom,i.transform)}}}let v=r.data.search(r.bbox);for(var m of v)if(m.draw(o,m.anchor.clone().mult(r.transform.scale).add(r.transform.translate)),s){o.lineWidth=1,o.strokeStyle="black",o.fillStyle="black",o.globalAlpha=1;let F=new De.default(m.minX,m.minY).mult(r.transform.scale).add(r.transform.translate),h=new De.default(m.maxX,m.maxY).mult(r.transform.scale).add(r.transform.translate),f=m.anchor.clone().mult(r.transform.scale).add(r.transform.translate);o.strokeRect(F.x,F.y,h.x-F.x,h.y-F.y),o.fillRect(f.x-2,f.y-2,4,4)}return performance.now()-a}var O=E($());var dt=E(ct()),Ve=class{constructor(e,i,r,n){this.tree=new dt.default,this.view=e,this.z=i,this.scratch=r,this.labelStyle=n}layout(e,i){let r=performance.now();if(!this.active)return!1;let n=new Set,s=1<<this.z-e.z-this.view.levelDiff,a=this.view.dataResolution;for(var[o,l]of this.labelStyle.entries()){if(l.visible==!1)continue;let u=i[l.dataLayer];if(u===void 0)continue;let c=u;l.sort&&c.sort((x,g)=>l.sort(x.properties,g.properties));for(let x of c){if(l.filter&&!l.filter(x.properties))continue;let g=l.symbolizer.stash(this.scratch,x,this.z);if(!g)continue;let v=g.anchor,m=g.bbox,F={minX:(e.x*a+v.x)*s+m.minX,minY:(e.y*a+v.y)*s+m.minY,maxX:(e.x*a+v.x)*s+m.maxX,maxY:(e.y*a+v.y)*s+m.maxY},h=this.tree.search(F);if(h.length==0){let f={anchor:new O.default(e.x*a+v.x,e.y*a+v.y).mult(s),draw:g.draw,order:o,key:te(e)};this.tree.insert(Object.assign(f,F));let d=a*s;(F.maxX>(e.x+1)*d||F.minX<e.x*d||F.minY<e.y*d||F.maxY>(e.y+1)*d)&&this.findSpills(n,e,F)}else{let f=!0;for(let d of h)o>=d.order&&(f=!1);if(f){for(let p of h)this.findSpills(n,e,p),this.tree.remove(p);let d={anchor:new O.default(e.x*a+v.x,e.y*a+v.y).mult(s),draw:g.draw,order:o};this.tree.insert(Object.assign(d,F))}}}}return n.size>0&&this.listener(n),!0}},Re=class extends Ve{constructor(e,i,r,n){super(e,i,r,n);this.active=!0}get(){return C(this,null,function*(){let e=yield this.view.get();for(let i of e)this.layout(i.tile,i.data);return{data:this.tree,bbox:{minX:0,minY:0,maxX:16384,maxY:16384},transform:{scale:.25,translate:new O.default(-0,-0)}}})}findSpills(){}},xt=class extends Ve{constructor(e,i,r,n,s){super(e,i,r,n);this.active=!1;this.current=new Set,this.inflight=new Map,this.listener=s}findSpills(e,i,r){let n=this.view.covering(this.z,i,r);for(let s of n){let a=te({z:s.z-2,x:Math.floor(s.x/4),y:Math.floor(s.y/4)});this.current.has(a)&&e.add(te(s))}}getTree(e){let i=te(e);return new Promise((r,n)=>{this.current.has(i)?r(this.tree):this.inflight.get(i)?this.inflight.get(i).push([r,n]):(this.inflight.set(i,[]),this.view.tileCache.get(e).then(s=>{if(this.layout(e,s)){if(this.current.add(i),this.inflight.get(i).forEach(o=>o[0](this.tree)),this.inflight.delete(i),r(this.tree),this.current.size>16){let o,l=0;for(let c of this.current){let x=c.split(":"),g=Math.sqrt(Math.pow(x[0]-e.x,2)+Math.pow(x[1]-e.y,2));g>l&&(l=g,o=c)}this.current.delete(o);let u=[];for(let c of this.tree.all())c.key===o&&u.push(c);u.forEach(c=>{this.tree.remove(c)})}}else this.inflight.get(i).forEach(o=>o[1]("Cancel label")),this.inflight.delete(i),n("Cancel label")}).catch(s=>{this.inflight.get(i).forEach(a=>a[1](s)),this.inflight.delete(i),n(s)}))})}bbox(e){let i=this.view.dataResolution/(1<<this.view.levelDiff);return{minX:e.x*i,minY:e.y*i,maxX:(e.x+1)*i,maxY:(e.y+1)*i}}transform(e){let i=this.view.dataResolution/(1<<this.view.levelDiff);if(e.z<this.view.levelDiff){if(e.z==0)return{scale:.0625,translate:new O.default(0,0)};if(e.z==1)return{scale:.125,translate:new O.default(e.x*-this.view.displayResolution,e.y*-this.view.displayResolution)}}else return{scale:.25,translate:new O.default(-e.x*i/4,-e.y*i/4)}}get(e){return C(this,null,function*(){let i=this.view.dataTile(e);return{data:yield this.getTree(i),bbox:this.bbox(e),transform:this.transform(e)}})}},pe=class{constructor(e,i,r,n){this.labelers=new Map,this.view=e,this.scratch=i,this.labelStyle=r,this.listener=n}get(e){return C(this,null,function*(){return this.labelers.forEach((i,r)=>{i.active=!1}),this.labelers.get(e.z)||this.labelers.set(e.z,new xt(this.view,e.z,this.scratch,this.labelStyle,this.listener)),this.labelers.get(e.z).active=!0,this.labelers.get(e.z).get(e)})}};var oe=E($());var Ft=E(pt());var bt=E(wt());function vt(t,e){let i,r,n=0;for(let s of t){let a=(0,bt.default)(s,Math.PI/2/9);for(let o of a)o.length>=e&&o.length>n&&(n=o.length,i=s[o.beginIndex],r=s[o.endIndex-1])}if(!!i)return{start:i,end:r}}var B=class{constructor(e){this.fill=e.fill||"#000000",this.opacity=e.opacity||1,this.pattern=e.pattern}before(e){this.pattern?e.fillStyle=e.createPattern(this.pattern,"repeat"):e.fillStyle=this.fill,e.globalAlpha=this.opacity}draw(e,i,r){e.beginPath();for(var n of i)for(var s=0;s<n.length-1;s++){let a=n[s].mult(r.scale).add(r.translate);s==0?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)}e.fill()}};function V(t,e,i){if(t<=i[0][0])return i[0][1];if(t>=i[i.length-1][0])return i[i.length-1][1];let r=0;for(;i[r+1][0]<t;)r++;let n=(t-i[r][0])/(i[r+1][0]-i[r][0]),s=Math.pow(n,e);return i[r][1]+s*(i[r+1][1]-i[r][1])}function Lt(t){return!!(t&&t.constructor&&t.call&&t.apply)}var P=class{constructor(e){this.color=e.color||"#000000",this.width=e.width||1,this.opacity=e.opacity||1}before(e,i){e.strokeStyle=this.color,e.globalAlpha=this.opacity,Lt(this.width)&&this.width.length==1?e.lineWidth=this.width(i):e.lineWidth=this.width}draw(e,i,r){e.beginPath();for(var n of i)for(var s=0;s<n.length;s++){let a=n[s].mult(r.scale).add(r.translate);s==0?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)}e.stroke()}},we=class{constructor(e){this.sprites=e.sprites,this.name=e.name}stash(e,i,r){let n=i.geom[0];return{anchor:new oe.default(i.geom[0][0].x,i.geom[0][0].y),bbox:{minX:-32,minY:-32,maxX:32,maxY:32},draw:(l,u)=>{l.globalAlpha=1;let c=this.sprites.get(this.name);l.drawImage(c.canvas,c.x,c.y,c.w,c.h,u.x-8,u.y-8,c.w/4,c.h/4)}}}},R=class{constructor(e){this.fill=e.fill,this.font=e.font,this.property=e.property||"name",this.stroke=e.stroke||"black",this.width=e.width||0,this.align=e.align||"left"}stash(e,i,r){let n=i.properties[this.property];if(!n)return null;if(i.geomType==xe.Point){let s=new oe.default(i.geom[0][0].x,i.geom[0][0].y),a=this.font;Lt(this.font)&&(a=this.font(i.properties,r)),e.font=a;let o=e.measureText(n),l=2,u=o.width,c=o.actualBoundingBoxAscent,x=o.actualBoundingBoxDescent,g={minX:0,minY:-c*4,maxX:u*4,maxY:x*4},v=[-l,-c-l,u+l*2,c+x+l*2],m=0;return this.align=="center"&&(g={minX:-u*4/2,minY:-c*4,maxX:u*4/2,maxY:x*4},v=[-l-u/2,-c-l,u+l*2,c+x+l*2],m=-u/2),{anchor:s,bbox:g,draw:(h,f)=>{h.globalAlpha=1,h.font=a,this.width&&(h.lineWidth=this.width,h.strokeStyle=this.stroke,h.strokeText(n,f.x+m,f.y)),h.fillStyle=this.fill,h.fillText(n,f.x+m,f.y)}}}}},Z=class{constructor(e){this.fill=e.fill||"black",this.stroke=e.stroke||"black",this.width=e.width||0,this.font=e.font||"12px sans-serif"}stash(e,i){let r=i.properties.name;if(!r)return;let n=i.bbox;if((n[3]-n[1])*(n[2]-n[0])<100)return;e.font=this.font;let o=e.measureText(r).width,l=vt(i.geom,o);if(!l)return;let u=l.end.x-l.start.x,c=l.end.y-l.start.y,x=new oe.default(l.start.x,l.start.y);var g=0,v=u,m=0,F=c;u<0&&(g=u,v=0),c<0&&(m=c,F=0);let h={minX:g*4,minY:m*4,maxX:v*4,maxY:F*4};return{anchor:x,bbox:h,draw:(d,p)=>{d.beginPath(),d.globalAlpha=1,d.moveTo(p.x,p.y),d.save(),d.translate(p.x,p.y),d.rotate(Math.atan2(c,u)),u<0&&d.scale(0,-1),d.font=this.font,this.stroke>0&&(d.strokeStyle=this.stroke,d.lineWidth=this.width,d.strokeText(r,0,0)),d.fillStyle=this.fill,d.fillText(r,0,0),d.restore()}}}},A=class{constructor(e){this.fill=e.fill||"black",this.font=e.font||"16px sans-serif"}stash(e,i){let r=i.bbox;if((r[3]-r[1])*(r[2]-r[0])<2e5)return;let s=i.properties.name;if(!s)return null;let a=i.geom[0],o=(0,Ft.default)([a.map(m=>[m.x,m.y])]),l=new oe.default(o[0],o[1]);e.font=this.font;let u=e.measureText(s),c=u.width,x={minX:-c*4/2,minY:-u.actualBoundingBoxAscent*4,maxX:c*4/2,maxY:u.actualBoundingBoxDescent*4},g=this.fill;return{anchor:l,bbox:x,draw:(m,F)=>{m.globalAlpha=1,m.fillStyle=g,m.font=this.font,m.fillText(s,F.x-c/2,F.y)}}}};var be=t=>[{dataLayer:"earth",symbolizer:new B({fill:t.earth})},{dataLayer:"natural",symbolizer:new B({fill:t.glacier}),filter:e=>e.natural=="glacier"},{dataLayer:"landuse",symbolizer:new B({fill:t.residential}),filter:e=>e.landuse=="residential"||e.place=="neighbourhood"},{dataLayer:"landuse",symbolizer:new B({fill:t.hospital}),filter:e=>e.amenity=="hospital"},{dataLayer:"landuse",symbolizer:new B({fill:t.cemetery}),filter:e=>e.landuse=="cemetery"},{dataLayer:"landuse",symbolizer:new B({fill:t.school}),filter:e=>e.amenity=="school"||e.amenity=="kindergarten"||e.amenity=="university"||e.amenity=="college"},{dataLayer:"landuse",symbolizer:new B({fill:t.industrial}),filter:e=>e.landuse=="industrial"},{dataLayer:"natural",symbolizer:new B({fill:t.wood}),filter:e=>e.natural=="wood"},{dataLayer:"landuse",symbolizer:new B({fill:t.grass}),filter:e=>e.landuse=="grass"},{dataLayer:"landuse",symbolizer:new B({fill:t.park}),filter:e=>e.leisure=="park"},{dataLayer:"water",symbolizer:new B({fill:t.water})},{dataLayer:"natural",symbolizer:new B({fill:t.sand}),filter:e=>e.natural=="sand"},{dataLayer:"buildings",symbolizer:new B({fill:t.buildings})},{dataLayer:"roads",symbolizer:new P({color:t.highwayCasing,width:e=>V(e,1.4,[[5,1.5],[11,4],[16,9],[20,40]])}),filter:e=>e["pmap:kind"]=="highway"},{dataLayer:"roads",symbolizer:new P({color:t.majorRoadCasing,width:e=>V(e,1.4,[[9,3],[12,4],[17,8],[20,22]])}),filter:e=>e["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new P({color:t.mediumRoadCasing,width:e=>V(e,1.4,[[13,3],[17,6],[20,18]])}),filter:e=>e["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new P({color:t.minorRoadCasing,width:e=>V(e,1.4,[[14,2],[17,5],[20,15]])}),filter:e=>e["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new P({color:t.highway,width:e=>V(e,1.4,[[5,.5],[11,2.5],[16,7],[20,30]])}),filter:e=>e["pmap:kind"]=="highway"},{dataLayer:"roads",symbolizer:new P({color:t.majorRoad,width:e=>V(e,1.4,[[9,2],[12,3],[17,6],[20,20]])}),filter:e=>e["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new P({color:t.mediumRoad,width:e=>V(e,1.4,[[13,2],[17,4],[20,15]])}),filter:e=>e["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new P({color:t.minorRoad,width:e=>V(e,1.4,[[14,1],[17,3],[20,13]])}),filter:e=>e["pmap:kind"]=="minor_road"},{dataLayer:"boundaries",symbolizer:new P({color:t.boundaries,width:2,opacity:.4})},{dataLayer:"mask",symbolizer:new B({fill:t.mask})}],ve=t=>[{dataLayer:"places",symbolizer:new R({fill:t.countryLabel,font:(e,i)=>i<6?"800 14px sans-serif":"800 20px sans-serif",align:"center"}),filter:e=>e["pmap:kind"]=="country"},{dataLayer:"places",symbolizer:new R({fill:t.cityLabel,font:(e,i)=>e["pmap:rank"]==1?i>8?"600 24px sans-serif":"400 14px sans-serif":i>8?"400 20px sans-serif":"400 12px sans-serif"}),sort:(e,i)=>e["pmap:rank"]-i["pmap:rank"],filter:e=>e["pmap:kind"]=="city"},{dataLayer:"places",symbolizer:new R({fill:t.stateLabel,font:"600 16px sans-serif"}),filter:e=>e["pmap:kind"]=="state"},{dataLayer:"places",symbolizer:new R({fill:t.neighbourhoodLabel,font:"400 12px sans-serif"}),filter:e=>e["pmap:kind"]=="neighbourhood"},{dataLayer:"landuse",symbolizer:new A({fill:t.landuseLabel,font:"400 14px sans-serif"})},{dataLayer:"water",symbolizer:new A({fill:t.waterLabel,font:"italic 600 16px sans-serif"})},{dataLayer:"natural",symbolizer:new A({fill:t.naturalLabel,font:"italic 400 12px sans-serif"})},{dataLayer:"roads",symbolizer:new Z({fill:t.roadsLabel})},{dataLayer:"pois",symbolizer:new R({fill:t.poisLabel,font:"400 10px sans-serif"})}];var Mt={earth:"#FFFBF6",glacier:"#ffffff",residential:"#e7e7e7",hospital:"#FFF6F6",cemetery:"#EFF2EE",school:"#F7F6FF",industrial:"#FFF9EF",wood:"#F4F9EF",grass:"#EBF9E3",park:"#E5F9D5",water:"#B7DFF2",sand:"#ebebeb",buildings:"#F2EDE8",highwayCasing:"#FFC3C3",majorRoadCasing:"#FFB9B9",mediumRoadCasing:"#FFCE8E",minorRoadCasing:"#cccccc",highway:"#FFCEBB",majorRoad:"#FFE4B3",mediumRoad:"#FFF2C8",minorRoad:"#ffffff",boundaries:"#9e9e9e",mask:"#dddddd",countryLabel:"#dddddd",cityLabel:"#6C6C6C",stateLabel:"#cccccc",neighbourhoodLabel:"#888888",landuseLabel:"#898989",waterLabel:"#717171",naturalLabel:"4c4c4c",roadsLabel:"#888888",poisLabel:"#606060"},le=be(Mt),he=ve(Mt);var Fe=class{constructor(e){this.paint_style=e.paint_style||le,this.label_style=e.label_style||he;let i=new ae(new se(e.url));this.view=new Te(i,14,4096),this.debug=e.debug||!1}draw(e){return C(this,null,function*(){let i=new Re(this.view,1,e,this.label_style),r=yield this.view.get(),n=yield i.get();for(let s of r){let a=ye({ctx:e},"key",s,n,this.paint_style,!1)}})}};var St={earth:"#151515",glacier:"#1c1c1c",residential:"#252B2F",hospital:"#3E2C2C",cemetery:"#36483D",school:"#2C3440",industrial:"#33312C",wood:"#3A3E38",grass:"#4E604D",park:"#2C4034",water:"#4D5B73",sand:"#777777",buildings:"#464545",highwayCasing:"#000000",majorRoadCasing:"#1C1B1B",mediumRoadCasing:"#3E3E3E",minorRoadCasing:"#000000",highway:"#5B5B5B",majorRoad:"#595959",mediumRoad:"#4F4F4F",minorRoad:"#393939",boundaries:"#666666",mask:"#dddddd",countryLabel:"#ffffff",cityLabel:"#FFFFFF",stateLabel:"#ffffff",neighbourhoodLabel:"#FDFDFD",landuseLabel:"#DDDDDD",waterLabel:"#707E95",naturalLabel:"#4c4c4c",roadsLabel:"#C4C4C4",poisLabel:"#959393"},Ie=be(St),Ue=ve(St);var _t=class{constructor(){this.unused=[]}get(e,i){if(this.unused.length){let n=this.unused.shift();return n.removed=!1,n}let r=L.DomUtil.create("canvas","leaflet-tile");return r.width=e,r.height=e,r}put(e){L.DomEvent.off("click"),L.DomUtil.removeClass(e,"leaflet-tile-loaded"),this.unused.push(e)}},wi=t=>new Promise((e,i)=>{setTimeout(()=>{e()},t)}),Le=class extends L.GridLayer{constructor(e){e.noWrap&&!e.bounds&&(e.bounds=[[-90,-180],[90,180]]),super(e),this.paint_style=e.paint_style||(e.dark?Ie:le),this.label_style=e.label_style||(e.dark?Ue:he);let i;e.url.url?i=new me(e.url):e.url.endsWith(".pmtiles")?i=new me(e.url):i=new se(e.url),this.tasks=e.tasks||[];let r=new ae(i);this.view=new Be(r,14,4096,2,256),this.debug=e.debug||!1,this.lang=e.lang;let n=document.createElement("canvas").getContext("2d");this.scratch=n,this.knockoutTiles=s=>{s.forEach(a=>{this.rerenderTile(a)})},this.labelers=new pe(this.view,this.scratch,this.label_style,this.knockoutTiles),this.tile_size=256*window.devicePixelRatio,this.pool=new _t,this._onClick=null}setDefaultStyle(e){this.paint_style=e?Ie:le,this.label_style=e?Ue:he}onClick(e){this._onClick=e}renderTile(e,i,r,n=()=>{}){return C(this,null,function*(){let s={element:i,tile_size:this.tile_size,ctx:null};var a,o;try{a=yield this.view.get(e),o=yield this.labelers.get(e)}catch(m){return}if(!this._map)return;let l=this._map.getCenter().wrap();var u=this._getTiledPixelBounds(l),c=this._pxBoundsToTileRange(u),x=c.getCenter();let g=e.distanceTo(x)*5;yield wi(g),yield Promise.all(this.tasks);let v=ye(s,r,a,o,this.paint_style,this.debug);if(this.debug){let m=s.ctx;if(!m)return;let F=this.view.dataTile(e);m.save(),m.fillStyle="black",m.globalAlpha=.5,m.fillStyle="#000",m.font="800 12px sans-serif",m.fillText(e.z+" "+e.x+" "+e.y,4,14),(F.x%2+F.y%2)%2==0?m.fillStyle="black":m.fillStyle="blue",m.fillText(F.z+" "+F.x+" "+F.y,4,28),m.fillStyle="red",v>8&&m.fillText(v.toFixed()+" ms",4,42),m.strokeStyle="#000",m.strokeRect(0,0,256,256),m.restore()}n()})}rerenderTile(e){for(var i in this._tiles){let r=this._wrapCoords(this._keyToTileCoords(i));e===this._tileCoordsToKey(r)&&this.renderTile(r,this._tiles[i].el,e)}}clearLayout(){this.labelers=new pe(this.view,this.scratch,this.label_style,this.knockoutTiles)}rerenderTiles(){for(var e in this._tiles){let i=this._wrapCoords(this._keyToTileCoords(e)),r=this._tileCoordsToKey(i);this.renderTile(i,this._tiles[e].el,r)}}createTile(e,i){let r=this.pool.get(this.tile_size,s=>{let a=this._map.mouseEventToLatLng(s);this.view.within(e,s.offsetX,s.offsetY).then(o=>{this._onClick(a,o)})}),n=this._tileCoordsToKey(e);return r.key=n,this.renderTile(e,r,n,()=>{i(null,r)}),r}_removeTile(e){var i=this._tiles[e];!i||(i.el.removed=!0,i.el.key=void 0,L.DomUtil.remove(i.el),this.pool.put(i.el),delete this._tiles[e],this.fire("tileunload",{tile:i.el,coords:this._keyToTileCoords(e)}))}};function Ze(t){if(t.includes("$type"))return e=>!0;if(t[0]=="==")return e=>e[t[1]]===t[2];if(t[0]=="!=")return e=>e[t[1]]!==t[2];if(t[0]==="<")return e=>e[t[1]]<t[2];if(t[0]===">")return e=>e[t[1]]>t[2];if(t[0]==="in")return e=>t.slice(2,t.length).includes(e[t[1]]);if(t[0]==="!in")return e=>!t.slice(2,t.length).includes(e[t[1]]);if(t[0]==="has")return e=>e.hasOwnProperty(t[1]);if(t[0]==="all"){let e=t.slice(1,t.length).map(i=>Ze(i));return i=>e.every(r=>r(i))}else if(t[0]==="any"){let e=t.slice(1,t.length).map(i=>Ze(i));return i=>e.some(r=>r(i))}else console.log("Unimplemented: ",t[0])}function zt(t){if(!t||typeof t=="number")return t;if(t.base&&t.stops)return e=>V(e,t.base,t.stops);console.log("Unimplemented: ",t)}function bi(t,e={}){let i=[];for(let n of t["text-font"])e.hasOwnProperty(n)&&i.push(e[n]);i.length===0&&i.push("sans-serif");let r=t["text-size"];if(typeof r=="number")return`${r}px ${i.join(", ")}`;if(r.stops)return r.base=1.4,n=>`${zt(r)(n)}px ${i.join(", ")}`;console.log("Can't parse font: ",t)}function Ae(t){let e=[],i=[],r=new Map;for(var n of t.layers){if(r.set(n.id,n),n.layout&&n.layout.visibility=="none")continue;if(n.ref){let l=r.get(n.ref);n.type=l.type,n.filter=l.filter,n.source=l.source,n["source-layer"]=l["source-layer"]}let o=n["source-layer"];var s,a=void 0;n.filter&&(a=Ze(n.filter)),n.type=="fill"?e.push({dataLayer:n["source-layer"],filter:a,symbolizer:new B({fill:n.paint["fill-color"],opacity:n.paint["fill-opacity"]})}):n.type=="line"?e.push({dataLayer:n["source-layer"],filter:a,symbolizer:new P({color:n.paint["line-color"],width:zt(n.paint["line-width"])})}):n.type=="symbol"&&(n.layout["symbol-placement"]=="line"?i.push({dataLayer:n["source-layer"],filter:a,symbolizer:new Z({fill:n.paint["text-color"],width:n.paint["text-halo-width"],stroke:n.paint["text-halo-color"]})}):i.push({dataLayer:n["source-layer"],filter:a,symbolizer:new R({font:bi(n.layout),fill:n.paint["text-color"],stroke:n.paint["text-halo-color"],width:n.paint["text-halo-width"]})}))}return{paint_style:e,label_style:i}}var vi=t=>{let e=0,i=0;for(let o of t)e+=o.w*o.h,i=Math.max(i,o.w);t.sort((o,l)=>l.h-o.h);let r=Math.max(Math.ceil(Math.sqrt(e/.95)),i),n=[{x:0,y:0,w:r,h:Infinity}],s=0,a=0;for(let o of t)for(let l=n.length-1;l>=0;l--){let u=n[l];if(!(o.w>u.w||o.h>u.h)){if(o.x=u.x,o.y=u.y,a=Math.max(a,o.y+o.h),s=Math.max(s,o.x+o.w),o.w===u.w&&o.h===u.h){let c=n.pop();l<n.length&&(n[l]=c)}else o.h===u.h?(u.x+=o.w,u.w-=o.w):o.w===u.w?(u.y+=o.h,u.h-=o.h):(n.push({x:u.x+o.w,y:u.y,w:u.w-o.w,h:o.h}),u.y+=o.h,u.h-=o.h);break}}return{w:s,h:a,fill:e/(s*a)||0}},Fi=t=>new Promise((e,i)=>{let r=new Image;r.onload=()=>e(r),r.onerror=i,r.src=t}),qe=class{constructor(e){this.src=e,this.canvas=null}load(){return C(this,null,function*(){let e=this.src,i=window.devicePixelRatio;if(typeof e=="string"&&e.endsWith(".html")){let u=yield(yield fetch(e)).text();e=new window.DOMParser().parseFromString(u,"text/html").body.children}this.mapping={};let r=[];for(let l of e){var n=btoa(new XMLSerializer().serializeToString(l)),s="data:image/svg+xml;base64,"+n;let u=yield Fi(s);r.push({w:u.width*i,h:u.height*i,img:u,id:l.id})}let a=vi(r);this.canvas=document.createElement("canvas"),this.canvas.width=a.w,this.canvas.height=a.h;let o=this.canvas.getContext("2d");for(let l of r)o.drawImage(l.img,l.x,l.y,l.w,l.h),this.mapping[l.id]={x:l.x,y:l.y,w:l.w,h:l.h};return this})}get(e){let i=this.mapping[e];if(!i)throw new Error(e+" not found");return i.canvas=this.canvas,i}},kt=qe;var je=(t,e,i)=>{let r=new FontFace(t,"url("+e+")",{weight:i});return document.fonts.add(r),r.load()},Oe=t=>new kt(t);return Li;})();
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
